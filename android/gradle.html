<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.27">
    <title>Gradle | NOTES</title><meta name="description" content="Just playing around">
    <link rel="modulepreload" href="/assets/app.39480b94.js"><link rel="modulepreload" href="/assets/gradle.html.c434c0f7.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper.21dcd24c.js"><link rel="modulepreload" href="/assets/gradle.html.6c2fbe5c.js">
    <link rel="stylesheet" href="/assets/style.4634000d.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><span class="site-name">NOTES</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><!----><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><!----><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--[--><p class="sidebar-heading sidebar-item">Gradle</p><ul class=""><li><!--[--><a aria-current="page" href="/android/gradle.html#wrapper" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Wrapper"><!--[--><!--]--> Wrapper <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/android/gradle.html#切换版本" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="切换版本"><!--[--><!--]--> 切换版本 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/android/gradle.html#常用命令" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="常用命令"><!--[--><!--]--> 常用命令 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/android/gradle.html#groovy" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Groovy"><!--[--><!--]--> Groovy <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/android/gradle.html#基本类型" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="基本类型"><!--[--><!--]--> 基本类型 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/android/gradle.html#插值" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="插值"><!--[--><!--]--> 插值 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/android/gradle.html#遍历" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="遍历"><!--[--><!--]--> 遍历 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/android/gradle.html#循环" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="循环"><!--[--><!--]--> 循环 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/android/gradle.html#函数" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="函数"><!--[--><!--]--> 函数 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/android/gradle.html#闭包" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="闭包"><!--[--><!--]--> 闭包 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/android/gradle.html#类" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="类"><!--[--><!--]--> 类 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/android/gradle.html#dsl" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="DSL"><!--[--><!--]--> DSL <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/android/gradle.html#配置脚本" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="配置脚本"><!--[--><!--]--> 配置脚本 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/android/gradle.html#生命周期" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="生命周期"><!--[--><!--]--> 生命周期 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/android/gradle.html#task" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Task"><!--[--><!--]--> Task <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/android/gradle.html#在任务执行前" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="在任务执行前"><!--[--><!--]--> 在任务执行前 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/android/gradle.html#在任务执行后" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="在任务执行后"><!--[--><!--]--> 在任务执行后 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/android/gradle.html#查找特定任务" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="查找特定任务"><!--[--><!--]--> 查找特定任务 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/android/gradle.html#本次构建所有任务" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="本次构建所有任务"><!--[--><!--]--> 本次构建所有任务 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/android/gradle.html#插件" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="插件"><!--[--><!--]--> 插件 <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/android/gradle.html#二进制插件" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="二进制插件"><!--[--><!--]--> 二进制插件 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/android/gradle.html#脚本插件" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="脚本插件"><!--[--><!--]--> 脚本插件 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/android/gradle.html#插件开发" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="插件开发"><!--[--><!--]--> 插件开发 <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/android/gradle.html#基础结构" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="基础结构"><!--[--><!--]--> 基础结构 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/android/gradle.html#extension" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Extension"><!--[--><!--]--> Extension <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/android/gradle.html#发布插件" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="发布插件"><!--[--><!--]--> 发布插件 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/android/gradle.html#使用本地仓库" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="使用本地仓库"><!--[--><!--]--> 使用本地仓库 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/android/gradle.html#apt" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="APT"><!--[--><!--]--> APT <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/android/gradle.html#声明注解" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="声明注解"><!--[--><!--]--> 声明注解 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/android/gradle.html#使用注解" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="使用注解"><!--[--><!--]--> 使用注解 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/android/gradle.html#声明注解处理器" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="声明注解处理器"><!--[--><!--]--> 声明注解处理器 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/android/gradle.html#使用注解处理器" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="使用注解处理器"><!--[--><!--]--> 使用注解处理器 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/android/gradle.html#kotlin" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Kotlin"><!--[--><!--]--> Kotlin <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/android/gradle.html#注解处理器支持" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="注解处理器支持"><!--[--><!--]--> 注解处理器支持 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/android/gradle.html#向-kapt-传递参数" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="向 Kapt 传递参数"><!--[--><!--]--> 向 Kapt 传递参数 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/android/gradle.html#动态-kapt-参数注入" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="动态 Kapt 参数注入"><!--[--><!--]--> 动态 Kapt 参数注入 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/android/gradle.html#字节码插桩" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="字节码插桩"><!--[--><!--]--> 字节码插桩 <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/android/gradle.html#目录结构" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="目录结构"><!--[--><!--]--> 目录结构 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/android/gradle.html#transform" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Transform"><!--[--><!--]--> Transform <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/android/gradle.html#使用插桩" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="使用插桩"><!--[--><!--]--> 使用插桩 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/android/gradle.html#构建管理" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="构建管理"><!--[--><!--]--> 构建管理 <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/android/gradle.html#环境变量" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="环境变量"><!--[--><!--]--> 环境变量 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/android/gradle.html#敏感信息" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="敏感信息"><!--[--><!--]--> 敏感信息 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/android/gradle.html#查看依赖树" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="查看依赖树"><!--[--><!--]--> 查看依赖树 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/android/gradle.html#禁止某项依赖" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="禁止某项依赖"><!--[--><!--]--> 禁止某项依赖 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/android/gradle.html#android-项目" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Android 项目"><!--[--><!--]--> Android 项目 <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/android/gradle.html#基础结构-1" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="基础结构"><!--[--><!--]--> 基础结构 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/android/gradle.html#引入第三方库" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="引入第三方库"><!--[--><!--]--> 引入第三方库 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/android/gradle.html#多项目构建" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="多项目构建"><!--[--><!--]--> 多项目构建 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/android/gradle.html#释出优化" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="释出优化"><!--[--><!--]--> 释出优化 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/android/gradle.html#应用签名" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="应用签名"><!--[--><!--]--> 应用签名 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/android/gradle.html#多渠道构建" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="多渠道构建"><!--[--><!--]--> 多渠道构建 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/android/gradle.html#多-dex-支持" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="多 Dex 支持"><!--[--><!--]--> 多 Dex 支持 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/android/gradle.html#自定义常量" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="自定义常量"><!--[--><!--]--> 自定义常量 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/android/gradle.html#自定义资源" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="自定义资源"><!--[--><!--]--> 自定义资源 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li></ul><!--]--><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="gradle" tabindex="-1"><a class="header-anchor" href="#gradle" aria-hidden="true">#</a> Gradle</h1><h2 id="wrapper" tabindex="-1"><a class="header-anchor" href="#wrapper" aria-hidden="true">#</a> Wrapper</h2><p>Gradle Wrapper 是 Gradle 的包装器。使用 <code>gradle wrapper</code> 命令可在当前项目目录生成 <code>gradlew</code> 文件。</p><h3 id="切换版本" tabindex="-1"><a class="header-anchor" href="#切换版本" aria-hidden="true">#</a> 切换版本</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>./gradlew wrapper --gradle-version <span class="token number">6.4</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>操作完成后，可通过 <code>cat gradle/wrapper/gradle-wrapper.properties</code> 查看变更后的版本信息。</p><h3 id="常用命令" tabindex="-1"><a class="header-anchor" href="#常用命令" aria-hidden="true">#</a> 常用命令</h3><ul><li>清除构建 ./gradlew clean</li><li>查看所有任务 ./gradlew tasks</li><li>查看所有子工程 ./gradlew projects</li></ul><h2 id="groovy" tabindex="-1"><a class="header-anchor" href="#groovy" aria-hidden="true">#</a> Groovy</h2><p>Groovy 是一门运行在 Java 平台上的动态语言。Groovy 在运行时被编译为 Java 虚拟机字节码，并可以与其它 Java 代码和库进行交互。</p><h3 id="基本类型" tabindex="-1"><a class="header-anchor" href="#基本类型" aria-hidden="true">#</a> 基本类型</h3><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code><span class="token comment">// 数字</span>
<span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">10</span>
<span class="token keyword">double</span> b <span class="token operator">=</span> <span class="token number">3.14</span>

<span class="token comment">// 字符串</span>
String str <span class="token operator">=</span> <span class="token string gstring">&quot;Hello World&quot;</span>
String str2 <span class="token operator">=</span> str <span class="token operator">+</span> str<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 列表</span>
<span class="token keyword">def</span> list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>

<span class="token comment">// 映射</span>
<span class="token keyword">def</span> map <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string gstring">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string gstring">&quot;Lucy&quot;</span><span class="token punctuation">,</span> <span class="token string gstring">&quot;age&quot;</span><span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="插值" tabindex="-1"><a class="header-anchor" href="#插值" aria-hidden="true">#</a> 插值</h3><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>String str <span class="token operator">=</span> <span class="token string gstring">&quot;Hello&quot;</span>
String str2 <span class="token operator">=</span> <span class="token string gstring">&quot;str = <span class="token expression"><span class="token punctuation">$</span>str</span>&quot;</span>

<span class="token keyword">def</span> map <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string gstring">&quot;a&quot;</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string gstring">&quot;b&quot;</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string gstring">&quot;c&quot;</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">]</span>
String str3 <span class="token operator">=</span> <span class="token string gstring">&quot;a = <span class="token expression"><span class="token punctuation">$</span>map<span class="token punctuation">.</span>a</span>, b = <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>map<span class="token punctuation">.</span>b<span class="token punctuation">}</span></span>, c = ${map[&quot;</span>c<span class="token string gstring">&quot;]}&quot;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="遍历" tabindex="-1"><a class="header-anchor" href="#遍历" aria-hidden="true">#</a> 遍历</h3><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>list<span class="token punctuation">.</span>each <span class="token punctuation">{</span>
    println <span class="token string gstring">&quot;item: <span class="token expression"><span class="token punctuation">$</span>it</span>&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="循环" tabindex="-1"><a class="header-anchor" href="#循环" aria-hidden="true">#</a> 循环</h3><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    println i
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="函数" tabindex="-1"><a class="header-anchor" href="#函数" aria-hidden="true">#</a> 函数</h3><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code><span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span>String name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    println name
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string gstring">&quot;Lily&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="闭包" tabindex="-1"><a class="header-anchor" href="#闭包" aria-hidden="true">#</a> 闭包</h3><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code><span class="token comment">// 无参</span>
<span class="token keyword">def</span> closure <span class="token operator">=</span> <span class="token punctuation">{</span> println <span class="token string gstring">&quot;Hello Closure&quot;</span> <span class="token punctuation">}</span>
<span class="token function">closure</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 有参</span>
<span class="token keyword">def</span> closure2 <span class="token operator">=</span> <span class="token punctuation">{</span> it <span class="token operator">-&gt;</span> println <span class="token string gstring">&quot;Hello <span class="token expression"><span class="token punctuation">$</span>it</span>&quot;</span> <span class="token punctuation">}</span>
<span class="token function">closure2</span><span class="token punctuation">(</span><span class="token string gstring">&quot;Lucy&quot;</span><span class="token punctuation">)</span>

<span class="token comment">// 多个参数</span>
<span class="token keyword">def</span> closure3 <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> age <span class="token operator">-&gt;</span>
    println <span class="token string gstring">&quot;name: <span class="token expression"><span class="token punctuation">$</span>name</span>, age: <span class="token expression"><span class="token punctuation">$</span>age</span>&quot;</span>
<span class="token punctuation">}</span>
<span class="token function">closure3</span><span class="token punctuation">(</span><span class="token string gstring">&quot;Lily&quot;</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span>

<span class="token comment">// 函数或方法可以省略括号</span>
closure
closure3 <span class="token string gstring">&quot;Lily&quot;</span> <span class="token number">18</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="类" tabindex="-1"><a class="header-anchor" href="#类" aria-hidden="true">#</a> 类</h3><p>类的语法与 Java 类似，这里便不再列举。</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
    <span class="token keyword">def</span> <span class="token function">say</span><span class="token punctuation">(</span>String name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        println <span class="token string gstring">&quot;I am <span class="token expression"><span class="token punctuation">$</span>name</span>&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">def</span> person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
person<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span><span class="token string gstring">&quot;Lily&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="dsl" tabindex="-1"><a class="header-anchor" href="#dsl" aria-hidden="true">#</a> DSL</h2><p>DSL（Domain specific language），领域特定语言。DSL 同样使用 Groovy 语言表达，下面将展示 Groovy 与 DSL 之间的映射关系。</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code><span class="token keyword">def</span> closure <span class="token operator">=</span> <span class="token punctuation">{</span>
    compileSdkVersion <span class="token number">29</span>

    defaultConfig <span class="token punctuation">{</span>
        versionName <span class="token string gstring">&quot;1.0&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>对应于如下的实体类</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code><span class="token keyword">class</span> <span class="token class-name">Android</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> compileSdkVersion
    <span class="token keyword">private</span> DefaultConfig defaultConfig

    <span class="token function">Android</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>defaultConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">def</span> <span class="token function">compileSdkVersion</span><span class="token punctuation">(</span><span class="token keyword">int</span> compileSdkVersion<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>compileSdkVersion <span class="token operator">=</span> compileSdkVersion
    <span class="token punctuation">}</span>

    <span class="token keyword">def</span> <span class="token function">defaultConfig</span><span class="token punctuation">(</span>Closure closure<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        closure<span class="token punctuation">.</span><span class="token function">setDelegate</span><span class="token punctuation">(</span>defaultConfig<span class="token punctuation">)</span>
        closure<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    String <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string gstring">&quot;Android { compileSdkVersion = <span class="token expression"><span class="token punctuation">$</span>compileSdkVersion</span>, defaultConfig = <span class="token expression"><span class="token punctuation">$</span>defaultConfig</span> }&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">DefaultConfig</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> String versionName

    <span class="token keyword">def</span> <span class="token function">versionName</span><span class="token punctuation">(</span>String versionName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>versionName <span class="token operator">=</span> versionName
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    String <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string gstring">&quot;DefaultConfig { versionName = <span class="token expression"><span class="token punctuation">$</span>versionName</span> }&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>最后将他们关联起来并运行：</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>closure<span class="token punctuation">.</span>delegate <span class="token operator">=</span> android
closure<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

println android
<span class="token comment">// Android { compileSdkVersion = 29, defaultConfig = DefaultConfig { versionName = 1.0 } }</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="配置脚本" tabindex="-1"><a class="header-anchor" href="#配置脚本" aria-hidden="true">#</a> 配置脚本</h2><ul><li>settings.gradle <ul><li>用于声明当前工程包含了哪些子工程</li></ul></li><li>build.gradle <ul><li>在工程根目录下的 <code>build.gradle</code> 文件用于定义所有子工程都可以共用的配置</li><li>每一个子工程目录下的 <code>build.gradle</code> 文件用于定义仅属于当前子工程的配置与构建行为</li></ul></li><li>gradle.properties <ul><li>定义 Gradle 自身与项目无关的参数，如运行时最大的可用内存空间</li></ul></li></ul><h2 id="生命周期" tabindex="-1"><a class="header-anchor" href="#生命周期" aria-hidden="true">#</a> 生命周期</h2><ul><li>初始化阶段（rootProject） <ul><li>在初始化阶段，收集需要参与本次构建的所有子工程，创建项目的层次结构，并且为每个子项目创建一个 Project 实例。<code>settings.gradle</code> 文件在初始化阶段前被执行。</li></ul></li><li>配置阶段（project） <ul><li>配置阶段会分别执行各个子项目中的 <code>build.gradle</code> 文件，完成对当前子项目 Project 对象的配置。并且根据项目自身配置构建出一个任务依赖关系图，以便在下个阶段执行。</li></ul></li><li>执行阶段（task） <ul><li>把「配置阶段」所生成的任务依赖图依次执行，执行完成后整个生命周期结束。</li></ul></li></ul><h2 id="task" tabindex="-1"><a class="header-anchor" href="#task" aria-hidden="true">#</a> Task</h2><p>使用 task 指令定义构建任务，一个或多个任务组成构建流程。</p><p>更多信息参阅：<a href="https://docs.gradle.org/current/dsl/org.gradle.api.task.html" target="_blank" rel="noopener noreferrer">Task 对象<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> 、 <a href="https://docs.gradle.org/current/userguide/build_lifecycle.html" target="_blank" rel="noopener noreferrer">构建生命周期<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p><h3 id="在任务执行前" tabindex="-1"><a class="header-anchor" href="#在任务执行前" aria-hidden="true">#</a> 在任务执行前</h3><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>project<span class="token punctuation">.</span>clean<span class="token punctuation">.</span>doFirst <span class="token punctuation">{</span>
    println <span class="token string gstring">&quot;Should be first&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="在任务执行后" tabindex="-1"><a class="header-anchor" href="#在任务执行后" aria-hidden="true">#</a> 在任务执行后</h3><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>project<span class="token punctuation">.</span>clean<span class="token punctuation">.</span>doLast <span class="token punctuation">{</span>
    println <span class="token string gstring">&quot;Should be last&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="查找特定任务" tabindex="-1"><a class="header-anchor" href="#查找特定任务" aria-hidden="true">#</a> 查找特定任务</h3><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>project<span class="token punctuation">.</span>tasks<span class="token punctuation">.</span>findAll <span class="token punctuation">{</span> task <span class="token operator">-&gt;</span>
    task<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string gstring">&quot;compile&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">.</span>each <span class="token punctuation">{</span> task <span class="token operator">-&gt;</span>
    task<span class="token punctuation">.</span>doFirst <span class="token punctuation">{</span>
        <span class="token comment">// TODO</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="本次构建所有任务" tabindex="-1"><a class="header-anchor" href="#本次构建所有任务" aria-hidden="true">#</a> 本次构建所有任务</h3><p>在 <code>build.gradle</code> 文件中加入</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>gradle<span class="token punctuation">.</span>taskGraph<span class="token punctuation">.</span>beforeTask <span class="token punctuation">{</span> task <span class="token operator">-&gt;</span>
    println <span class="token string gstring">&quot;[all-task] <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>task<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span>&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="插件" tabindex="-1"><a class="header-anchor" href="#插件" aria-hidden="true">#</a> 插件</h2><p>Gradle 的插件分为：二进制插件、脚本插件两类。</p><h3 id="二进制插件" tabindex="-1"><a class="header-anchor" href="#二进制插件" aria-hidden="true">#</a> 二进制插件</h3><p>首先需要在根目录的 <code>build.gradle</code> 文件中声明插件依赖</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>buildscript <span class="token punctuation">{</span>
    repositories <span class="token punctuation">{</span>
        <span class="token function">google</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token function">jcenter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    dependencies <span class="token punctuation">{</span>
        classpath <span class="token string gstring">&quot;com.android.tools.build:gradle:4.1.1&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><div class="highlight-line"> </div><br><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>之后就可以在子项目的 <code>build.gradle</code> 文件中使用此插件。</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>plugins <span class="token punctuation">{</span> id <span class="token string">&#39;com.android.application&#39;</span> <span class="token punctuation">}</span>
<span class="token comment">// 或者，较旧的方式</span>
apply plugin<span class="token punctuation">:</span> <span class="token string">&#39;com.android.application&#39;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="脚本插件" tabindex="-1"><a class="header-anchor" href="#脚本插件" aria-hidden="true">#</a> 脚本插件</h3><p>脚本插件可以仅是一个独立的 gradle 文件，比如我在根目录有一个 <code>test.gradle</code> 文件：</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>println <span class="token string gstring">&quot;Test plugin&quot;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>如果想要使用该插件便需要在子项目的 <code>build.gradle</code> 文件中声明</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>apply from<span class="token punctuation">:</span> project<span class="token punctuation">.</span>rootProject<span class="token punctuation">.</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string gstring">&quot;test.gradle&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="插件开发" tabindex="-1"><a class="header-anchor" href="#插件开发" aria-hidden="true">#</a> 插件开发</h2><p>在项目跟目录下创建一个名为 <code>buildSrc</code> 的目录，该目录的文件会被自动识别为 Gradle 的插件源码。</p><h3 id="基础结构" tabindex="-1"><a class="header-anchor" href="#基础结构" aria-hidden="true">#</a> 基础结构</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>.
├── build.gradle
└── src/main
    ├── groovy/com/ika/test
    │   ├── TestExtension.groovy
    │   └── TestPlugin.groovy
    └── resources/META-INF/gradle-plugins
        └── com.ika.test.properties
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>插件构建配置脚本 <strong><em>buildSrc/build.gradle</em></strong></p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>apply plugin<span class="token punctuation">:</span> <span class="token string">&#39;groovy&#39;</span>

repositories <span class="token punctuation">{</span>
    <span class="token function">jcenter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

dependencies <span class="token punctuation">{</span>
    implementation <span class="token function">gradleApi</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    implementation <span class="token function">localGroovy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>插件入口文件 <strong><em>buildSrc/src/main/groovy/com/ika/test/TestPlugin.groovy</em></strong></p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code><span class="token keyword">package</span> com<span class="token punctuation">.</span>ika<span class="token punctuation">.</span>test

<span class="token keyword">import</span> org<span class="token punctuation">.</span>gradle<span class="token punctuation">.</span>api<span class="token punctuation">.</span>Plugin
<span class="token keyword">import</span> org<span class="token punctuation">.</span>gradle<span class="token punctuation">.</span>api<span class="token punctuation">.</span>Project

<span class="token keyword">class</span> <span class="token class-name">TestPlugin</span> <span class="token keyword">implements</span> <span class="token class-name">Plugin</span><span class="token operator">&lt;</span>Project<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">void</span> <span class="token function">apply</span><span class="token punctuation">(</span>Project project<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        println <span class="token string gstring">&quot;test&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>插件属性配置 <strong><em>buildSrc/src/main/resources/META-INF/gradle-plugins/com.ika.test.properties</em></strong></p><div class="language-ini ext-ini line-numbers-mode"><pre class="language-ini"><code><span class="token key attr-name">implementation-class</span><span class="token punctuation">=</span><span class="token value attr-value">com.ika.test.TestPlugin</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h3 id="extension" tabindex="-1"><a class="header-anchor" href="#extension" aria-hidden="true">#</a> Extension</h3><p>可以利用 Extension 开放用户对插件的配置接口。创建 <strong>buildSrc/src/main/groovy/com/ika/test/TestExtension.groovy</strong> 文件：</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code><span class="token keyword">package</span> com<span class="token punctuation">.</span>ika<span class="token punctuation">.</span>test

<span class="token keyword">class</span> <span class="token class-name">TestExtension</span> <span class="token punctuation">{</span>
    String dir  <span class="token comment">// 这是你的参数</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>之后在 <code>TestPlugin.groovy</code> 文件中注册 Extension：</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code><span class="token keyword">package</span> com<span class="token punctuation">.</span>ika<span class="token punctuation">.</span>test

<span class="token keyword">import</span> org<span class="token punctuation">.</span>gradle<span class="token punctuation">.</span>api<span class="token punctuation">.</span>Plugin
<span class="token keyword">import</span> org<span class="token punctuation">.</span>gradle<span class="token punctuation">.</span>api<span class="token punctuation">.</span>Project

<span class="token keyword">class</span> <span class="token class-name">TestPlugin</span> <span class="token keyword">implements</span> <span class="token class-name">Plugin</span><span class="token operator">&lt;</span>Project<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">void</span> <span class="token function">apply</span><span class="token punctuation">(</span>Project project<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        project<span class="token punctuation">.</span><span class="token function">getExtensions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string gstring">&quot;test&quot;</span><span class="token punctuation">,</span> TestExtension<span class="token punctuation">)</span>

        <span class="token comment">// 配置阶段结束，可以拿到插件配置了</span>
        project<span class="token punctuation">.</span>afterEvaluate <span class="token punctuation">{</span>
            TestExtension testExtension <span class="token operator">=</span> project<span class="token punctuation">.</span>test
            println <span class="token string gstring">&quot;Configured dir: <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>testExtension<span class="token punctuation">.</span>dir<span class="token punctuation">}</span></span>&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>最后需要在你项目的 <code>build.gradle</code> 文件中应用插件和插件配置：</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>apply plugin<span class="token punctuation">:</span> <span class="token string">&#39;com.ika.test&#39;</span>

test <span class="token punctuation">{</span>
    dir <span class="token function">getRootDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>absolutePath
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="发布插件" tabindex="-1"><a class="header-anchor" href="#发布插件" aria-hidden="true">#</a> 发布插件</h3><p>为了方便测试，这里采用本地仓库的模式。由于 <code>buildSrc</code> 是系统预设目录名，所以需要修改为其它名称，这里就改为 <code>plugin-source</code></p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>plugins <span class="token punctuation">{</span>
    id <span class="token string gstring">&quot;groovy&quot;</span>
    id <span class="token string gstring">&quot;maven&quot;</span>
<span class="token punctuation">}</span>

repositories <span class="token punctuation">{</span>
    <span class="token function">jcenter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

dependencies <span class="token punctuation">{</span>
    implementation <span class="token function">gradleApi</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    implementation <span class="token function">localGroovy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

uploadArchives <span class="token punctuation">{</span>
    repositories<span class="token punctuation">.</span>mavenDeployer <span class="token punctuation">{</span>
        <span class="token function">repository</span><span class="token punctuation">(</span>url<span class="token punctuation">:</span> <span class="token function">uri</span><span class="token punctuation">(</span><span class="token string gstring">&quot;../repo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            pom<span class="token punctuation">.</span>groupId <span class="token operator">=</span> <span class="token string gstring">&quot;com.ika.test&quot;</span>
            pom<span class="token punctuation">.</span>artifactId <span class="token operator">=</span> <span class="token string gstring">&quot;gradle&quot;</span>
            pom<span class="token punctuation">.</span>version <span class="token operator">=</span> <span class="token string gstring">&quot;1.0.0&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="highlight-lines"><br><br><div class="highlight-line"> </div><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>在插件构建脚本 <code>plugin-source/build.gradle</code> 中加入本地仓库的构建代码。之后修改根目录 <code>settings.gradle</code> 文件加入对插件的引用</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>include <span class="token string">&#39;:plugin-source&#39;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>最后使用 gradlew 构建本地仓库，此时根目录会出现一个名为 <code>repo</code> 的目录。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>./gradlew :plugin-source:uploadArchives
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h3 id="使用本地仓库" tabindex="-1"><a class="header-anchor" href="#使用本地仓库" aria-hidden="true">#</a> 使用本地仓库</h3><p>在项目根目录 <code>build.gradle</code> 文件中的 <code>buildscript</code> 或 <code>allprojects</code> 块中加入对本地仓库的引用</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>buildscript <span class="token punctuation">{</span>
    repositories <span class="token punctuation">{</span>
        <span class="token function">google</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token function">jcenter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        maven <span class="token punctuation">{</span> url <span class="token function">uri</span><span class="token punctuation">(</span><span class="token string gstring">&quot;./repo&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    dependencies <span class="token punctuation">{</span>
        classpath <span class="token string gstring">&quot;com.android.tools.build:gradle:4.1.1&quot;</span>
        classpath <span class="token string gstring">&quot;com.ika.test:gradle:1.0.0&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="highlight-lines"><br><br><br><br><div class="highlight-line"> </div><br><br><br><div class="highlight-line"> </div><br><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>注意 <code>classpath</code> 的值的格式是 <code>groupId:artifactId:version</code>。配置完成后便可以使用该插件了。</p><h2 id="apt" tabindex="-1"><a class="header-anchor" href="#apt" aria-hidden="true">#</a> APT</h2><p>APT(Annotation Processing Tool)，即注解处理器，是一种用于处理注解的工具。JVM 会在编译期运行 APT 去扫描代码中的注解然后输出 Java 文件。</p><h3 id="声明注解" tabindex="-1"><a class="header-anchor" href="#声明注解" aria-hidden="true">#</a> 声明注解</h3><p>在项目根目录创建 <code>annotation-source</code> 目录作为注解源码目录，目录结构如下</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>.
├── build.gradle
└── src/main/java/com/ika/test
    └── Page.java
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>注解构建配置脚本 <strong><em>annotation-source/build.gradle</em></strong></p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>apply plugin<span class="token punctuation">:</span> <span class="token string">&#39;java&#39;</span>

targetCompatibility <span class="token operator">=</span> JavaVersion<span class="token punctuation">.</span>VERSION_1_9
sourceCompatibility <span class="token operator">=</span> JavaVersion<span class="token punctuation">.</span>VERSION_1_9
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Page 注解声明文件 <strong><em>annotation-source/src/main/java/com/ika/test/Page.java</em></strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ika<span class="token punctuation">.</span>test</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ElementType</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Retention</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Target</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span>TYPE<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span>CLASS<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">Page</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> <span class="token function">url</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> <span class="token function">description</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="使用注解" tabindex="-1"><a class="header-anchor" href="#使用注解" aria-hidden="true">#</a> 使用注解</h3><p>在项目根目录的 <code>settings.gradle</code> 文件中引入注解：</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>include <span class="token string">&#39;:annotation-source&#39;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>然后在子项目的 <code>build.gradle</code> 文件中添加对注解的依赖：</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>dependencies <span class="token punctuation">{</span>
    implementation <span class="token function">project</span><span class="token punctuation">(</span><span class="token string">&#39;:annotation-source&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>最后便可在项目代码中使用注解，这里我使用 <code>app/src/main/java/com/example/myapp/MainActivity.java</code> 文件作为演示</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>myapp</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>ika<span class="token punctuation">.</span>test<span class="token punctuation">.</span></span><span class="token class-name">Page</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>os<span class="token punctuation">.</span></span><span class="token class-name">Bundle</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">androidx<span class="token punctuation">.</span>appcompat<span class="token punctuation">.</span>app<span class="token punctuation">.</span></span><span class="token class-name">AppCompatActivity</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Page</span><span class="token punctuation">(</span>url <span class="token operator">=</span> <span class="token string">&quot;page://main&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainActivity</span> <span class="token keyword">extends</span> <span class="token class-name">AppCompatActivity</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_main<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="highlight-lines"><br><br><div class="highlight-line"> </div><br><br><br><div class="highlight-line"> </div><br><br><br><br><br><br><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="声明注解处理器" tabindex="-1"><a class="header-anchor" href="#声明注解处理器" aria-hidden="true">#</a> 声明注解处理器</h3><p>在项目根目录创建 <code>processor-source</code> 目录作为注解处理器源码目录，目录结构如下</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>.
├── build.gradle
└── src/main/java/com/ika/test
    └── PageProcessor.java
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>注解处理器构建配置脚本 <strong><em>processor-source/build.gradle</em></strong></p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>apply plugin<span class="token punctuation">:</span> <span class="token string">&#39;java&#39;</span>

targetCompatibility <span class="token operator">=</span> JavaVersion<span class="token punctuation">.</span>VERSION_1_9
sourceCompatibility <span class="token operator">=</span> JavaVersion<span class="token punctuation">.</span>VERSION_1_9

dependencies <span class="token punctuation">{</span>
    implementation <span class="token function">project</span><span class="token punctuation">(</span><span class="token string">&#39;:annotation-source&#39;</span><span class="token punctuation">)</span>

    <span class="token comment">// auto-service 用于自动创建 META-INF/services/javax.annotation.processing.Processor 文件，</span>
    <span class="token comment">// 文件将包含 com.ika.test.PageProcessor，该文件在被 javac 发现后便会自动加载 PageProcessor 类了。</span>
    implementation <span class="token string">&#39;com.google.auto.service:auto-service:1.0-rc7&#39;</span>
    annotationProcessor <span class="token string">&#39;com.google.auto.service:auto-service:1.0-rc7&#39;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>Page 注解处理文件 <strong><em>processor-source/src/main/java/com/ika/test/PageProcessor.java</em></strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ika<span class="token punctuation">.</span>test</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>auto<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">AutoService</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Writer</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Collections</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Set</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>processing<span class="token punctuation">.</span></span><span class="token class-name">AbstractProcessor</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>processing<span class="token punctuation">.</span></span><span class="token class-name">Processor</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>processing<span class="token punctuation">.</span></span><span class="token class-name">RoundEnvironment</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>model<span class="token punctuation">.</span>element<span class="token punctuation">.</span></span><span class="token class-name">Element</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>model<span class="token punctuation">.</span>element<span class="token punctuation">.</span></span><span class="token class-name">TypeElement</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@AutoService</span><span class="token punctuation">(</span><span class="token class-name">Processor</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PageProcessor</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractProcessor</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> TEMPLATE <span class="token operator">=</span> <span class="token string">&quot;package com.ika.test; public class Generated { public static String get() { return \&quot;%s\&quot;; } }&quot;</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">TypeElement</span><span class="token punctuation">&gt;</span></span> set<span class="token punctuation">,</span> <span class="token class-name">RoundEnvironment</span> roundEnvironment<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>roundEnvironment<span class="token punctuation">.</span><span class="token function">processingOver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 获取所有标记了 @Page 注解的类信息</span>
        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Element</span><span class="token punctuation">&gt;</span></span> allPageElements <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Element</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> roundEnvironment<span class="token punctuation">.</span><span class="token function">getElementsAnnotatedWith</span><span class="token punctuation">(</span><span class="token class-name">Page</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>allPageElements<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">StringBuilder</span> builder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Element</span> element <span class="token operator">:</span> allPageElements<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">final</span> <span class="token class-name">TypeElement</span> typeElement <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">TypeElement</span><span class="token punctuation">)</span> element<span class="token punctuation">;</span>

            <span class="token comment">// 尝试在当前类获取 @Page 的信息</span>
            <span class="token keyword">final</span> <span class="token class-name">Page</span> page <span class="token operator">=</span> typeElement<span class="token punctuation">.</span><span class="token function">getAnnotation</span><span class="token punctuation">(</span><span class="token class-name">Page</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>page <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            builder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;\\nurl = &quot;</span> <span class="token operator">+</span> page<span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            builder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;\\ndescription = &quot;</span> <span class="token operator">+</span> page<span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            builder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;\\nreal_path = &quot;</span> <span class="token operator">+</span> typeElement<span class="token punctuation">.</span><span class="token function">getQualifiedName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Writer</span> writer <span class="token operator">=</span> processingEnv<span class="token punctuation">.</span><span class="token function">getFiler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createSourceFile</span><span class="token punctuation">(</span><span class="token string">&quot;com.ika.test.Generated&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">openWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>TEMPLATE<span class="token punctuation">,</span> builder<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            writer<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            writer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;Error while create file&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getSupportedAnnotationTypes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singleton</span><span class="token punctuation">(</span><span class="token class-name">Page</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getCanonicalName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br></div></div><h3 id="使用注解处理器" tabindex="-1"><a class="header-anchor" href="#使用注解处理器" aria-hidden="true">#</a> 使用注解处理器</h3><p>在项目根目录的 <code>settings.gradle</code> 文件中引入注解处理器：</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>include <span class="token string">&#39;:processor-source&#39;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>然后在子项目的 <code>build.gradle</code> 文件中添加对注解处理器的依赖：</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>dependencies <span class="token punctuation">{</span>
    annotationProcessor <span class="token function">project</span><span class="token punctuation">(</span><span class="token string">&#39;:processor-source&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>最后执行编译命令，便会自动生成 <code>app/build/generated/ap_generated_sources/debug/out/com/ika/test/Generated.java</code> 文件</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>./gradlew :app:assembleDebug
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="kotlin" tabindex="-1"><a class="header-anchor" href="#kotlin" aria-hidden="true">#</a> Kotlin</h2><p>添加项目对 Kotlin 的支持，修改项目根目录下的 <code>build.gradle</code> 文件，在 <code>dependencies</code> 块中添加依赖</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>dependencies <span class="token punctuation">{</span>
    classpath <span class="token string">&#39;org.jetbrains.kotlin:kotlin-gradle-plugin:1.4.30&#39;</span>
<span class="token punctuation">}</span>
</code></pre><div class="highlight-lines"><br><div class="highlight-line"> </div><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>然后在子项目的 build.gradle 文件中应用 Kotlin 插件，我的是 <code>app/build.gradle</code> 文件。</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>plugins <span class="token punctuation">{</span> id <span class="token string">&#39;kotlin-android&#39;</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h3 id="注解处理器支持" tabindex="-1"><a class="header-anchor" href="#注解处理器支持" aria-hidden="true">#</a> 注解处理器支持</h3><p>在子项目的 build.gradle 文件中应用 <code>kotlin-kapt</code> 插件</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>plugins <span class="token punctuation">{</span> id <span class="token string">&#39;kotlin-kapt&#39;</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>之后替换 <code>annotationProcessor</code> 命令</p><div class="language-diff ext-diff line-numbers-mode"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">dependencies {
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">    annotationProcessor project(&#39;:processor-source&#39;)
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    kapt project(&#39;:processor-source&#39;)
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">}
</span></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="向-kapt-传递参数" tabindex="-1"><a class="header-anchor" href="#向-kapt-传递参数" aria-hidden="true">#</a> 向 Kapt 传递参数</h3><p>在子项目的 <code>build.gradle</code> 文件的 <code>android</code> 块中添加你的参数</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>android <span class="token punctuation">{</span>
    kapt<span class="token punctuation">.</span>arguments <span class="token punctuation">{</span>
        <span class="token function">arg</span><span class="token punctuation">(</span><span class="token string gstring">&quot;rootProjectDir&quot;</span><span class="token punctuation">,</span> rootProject<span class="token punctuation">.</span>projectDir<span class="token punctuation">.</span>absolutePath<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="动态-kapt-参数注入" tabindex="-1"><a class="header-anchor" href="#动态-kapt-参数注入" aria-hidden="true">#</a> 动态 Kapt 参数注入</h3><p>我们可以在自己的插件中向其它插件注入信息，这里使用 kapt 作为示范向其注入参数。注意需要在应用我们自己的插件之前先应用 kapt 插件。</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code><span class="token keyword">import</span> org<span class="token punctuation">.</span>gradle<span class="token punctuation">.</span>api<span class="token punctuation">.</span>Plugin
<span class="token keyword">import</span> org<span class="token punctuation">.</span>gradle<span class="token punctuation">.</span>api<span class="token punctuation">.</span>Project

<span class="token keyword">class</span> <span class="token class-name">TestPlugin</span> <span class="token keyword">implements</span> <span class="token class-name">Plugin</span><span class="token operator">&lt;</span>Project<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">void</span> <span class="token function">apply</span><span class="token punctuation">(</span>Project project<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>project<span class="token punctuation">.</span>extensions<span class="token punctuation">.</span><span class="token function">findByName</span><span class="token punctuation">(</span><span class="token string gstring">&quot;kapt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            project<span class="token punctuation">.</span>extensions<span class="token punctuation">.</span><span class="token function">findByName</span><span class="token punctuation">(</span><span class="token string gstring">&quot;kapt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>arguments <span class="token punctuation">{</span>
                <span class="token function">arg</span><span class="token punctuation">(</span><span class="token string gstring">&quot;rootProjectDir&quot;</span><span class="token punctuation">,</span> project<span class="token punctuation">.</span>rootProject<span class="token punctuation">.</span>projectDir<span class="token punctuation">.</span>absolutePath<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="字节码插桩" tabindex="-1"><a class="header-anchor" href="#字节码插桩" aria-hidden="true">#</a> 字节码插桩</h2><p>Java 或 Kotlin 语言的源代码文件最终都会编译为 <code>.class</code> 字节码文件，运行在 JVM 虚拟机当中。</p><p>而利用插桩技术则可以实现动态代码插入、代码替换。实际应用来讲，无痕埋点、性能监控都会用到字节码插桩技术。</p><h3 id="目录结构" tabindex="-1"><a class="header-anchor" href="#目录结构" aria-hidden="true">#</a> 目录结构</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>.
├── build.gradle
└── src/main
    ├── groovy/com/ika/test
    │   ├── TestPlugin.groovy
    │   ├── TestTransform.groovy
    │   └── TestTransformCollector.groovy
    └── resources/META-INF/gradle-plugins
        └── com.ika.test.properties
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>插件构建配置脚本 <strong><em>buildSrc/build.gradle</em></strong></p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>repositories <span class="token punctuation">{</span>
    <span class="token function">jcenter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">google</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

dependencies <span class="token punctuation">{</span>
    implementation <span class="token string gstring">&quot;com.android.tools.build:gradle:4.1.1&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>插件属性配置 <strong><em>buildSrc/src/main/resources/META-INF/gradle-plugins/com.ika.test.properties</em></strong></p><div class="language-ini ext-ini line-numbers-mode"><pre class="language-ini"><code><span class="token key attr-name">implementation-class</span><span class="token punctuation">=</span><span class="token value attr-value">com.ika.test.TestPlugin</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h3 id="transform" tabindex="-1"><a class="header-anchor" href="#transform" aria-hidden="true">#</a> Transform</h3><p>由于 <code>.class</code> 文件最终都会打包为 <code>.dex</code> 文件，我们可以使用 Transform API 在生成 class 文件之后 dex 文件之前做一些事情。</p><p>插件 Transform 文件 <strong><em>buildSrc/src/main/groovy/com/ika/test/TestTransform.groovy</em></strong></p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code><span class="token keyword">package</span> com<span class="token punctuation">.</span>ika<span class="token punctuation">.</span>test

<span class="token keyword">import</span> com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>build<span class="token punctuation">.</span>api<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>*
<span class="token keyword">import</span> com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>build<span class="token punctuation">.</span>gradle<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>pipeline<span class="token punctuation">.</span>TransformManager
<span class="token keyword">import</span> com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>FileUtils

<span class="token keyword">class</span> <span class="token class-name">TestTransform</span> <span class="token keyword">extends</span> <span class="token class-name">Transform</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    String <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    Set<span class="token operator">&lt;</span>QualifiedContent<span class="token punctuation">.</span>ContentType<span class="token operator">&gt;</span> <span class="token function">getInputTypes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> TransformManager<span class="token punctuation">.</span>CONTENT_CLASS
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    Set<span class="token operator">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> QualifiedContent<span class="token punctuation">.</span>Scope<span class="token operator">&gt;</span> <span class="token function">getScopes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> TransformManager<span class="token punctuation">.</span>SCOPE_FULL_PROJECT
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">boolean</span> <span class="token function">isIncremental</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">void</span> <span class="token function">transform</span><span class="token punctuation">(</span>TransformInvocation transformInvocation<span class="token punctuation">)</span> <span class="token keyword">throws</span> TransformException<span class="token punctuation">,</span> InterruptedException<span class="token punctuation">,</span> IOException <span class="token punctuation">{</span>
        transformInvocation<span class="token punctuation">.</span>inputs<span class="token punctuation">.</span>each <span class="token punctuation">{</span>
            <span class="token comment">// JAR</span>
            it<span class="token punctuation">.</span>jarInputs<span class="token punctuation">.</span>each <span class="token punctuation">{</span> jarInput <span class="token operator">-&gt;</span>
                <span class="token keyword">def</span> destFile <span class="token operator">=</span> transformInvocation<span class="token punctuation">.</span>outputProvider<span class="token punctuation">.</span><span class="token function">getContentLocation</span><span class="token punctuation">(</span>jarInput<span class="token punctuation">.</span>name<span class="token punctuation">,</span> jarInput<span class="token punctuation">.</span>contentTypes<span class="token punctuation">,</span> jarInput<span class="token punctuation">.</span>scopes<span class="token punctuation">,</span> Format<span class="token punctuation">.</span>JAR<span class="token punctuation">)</span>

                TestTransformCollector<span class="token punctuation">.</span><span class="token function">jar</span><span class="token punctuation">(</span>jarInput<span class="token punctuation">.</span>file<span class="token punctuation">)</span>
                FileUtils<span class="token punctuation">.</span><span class="token function">copyFile</span><span class="token punctuation">(</span>jarInput<span class="token punctuation">.</span>file<span class="token punctuation">,</span> destFile<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// 目录</span>
            it<span class="token punctuation">.</span>directoryInputs<span class="token punctuation">.</span>each <span class="token punctuation">{</span> directoryInput <span class="token operator">-&gt;</span>
                <span class="token keyword">def</span> destDir <span class="token operator">=</span> transformInvocation<span class="token punctuation">.</span>outputProvider<span class="token punctuation">.</span><span class="token function">getContentLocation</span><span class="token punctuation">(</span>directoryInput<span class="token punctuation">.</span>name<span class="token punctuation">,</span> directoryInput<span class="token punctuation">.</span>contentTypes<span class="token punctuation">,</span> directoryInput<span class="token punctuation">.</span>scopes<span class="token punctuation">,</span> Format<span class="token punctuation">.</span>DIRECTORY<span class="token punctuation">)</span>

                TestTransformCollector<span class="token punctuation">.</span><span class="token function">fileOrDir</span><span class="token punctuation">(</span>directoryInput<span class="token punctuation">.</span>file<span class="token punctuation">)</span>
                FileUtils<span class="token punctuation">.</span><span class="token function">copyDirectory</span><span class="token punctuation">(</span>directoryInput<span class="token punctuation">.</span>file<span class="token punctuation">,</span> destDir<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><p>Transform 收集器 <strong><em>buildSrc/src/main/groovy/com/ika/test/TestTransformCollector.groovy</em></strong></p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code><span class="token keyword">package</span> com<span class="token punctuation">.</span>ika<span class="token punctuation">.</span>test

<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>jar<span class="token punctuation">.</span>JarEntry
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>jar<span class="token punctuation">.</span>JarFile

<span class="token keyword">class</span> <span class="token class-name">TestTransformCollector</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">jar</span><span class="token punctuation">(</span>File file<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Enumeration enumeration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JarFile</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">while</span> <span class="token punctuation">(</span>enumeration<span class="token punctuation">.</span><span class="token function">hasMoreElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            JarEntry jarEntry <span class="token operator">=</span> <span class="token punctuation">(</span>JarEntry<span class="token punctuation">)</span> enumeration<span class="token punctuation">.</span><span class="token function">nextElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

            <span class="token function">println</span><span class="token punctuation">(</span><span class="token string gstring">&quot;[jar-class] <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>jarEntry<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">fileOrDir</span><span class="token punctuation">(</span>File file<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">isFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">println</span><span class="token punctuation">(</span><span class="token string gstring">&quot;[file-class] <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>file<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            file<span class="token punctuation">.</span><span class="token function">listFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>each <span class="token punctuation">{</span>
                <span class="token function">fileOrDir</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>上面两个文件都准备好，便可以在插件入口文件 <code>buildSrc/src/main/groovy/com/ika/test/TestPlugin.groovy</code> 中注册 Transform。</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code><span class="token keyword">package</span> com<span class="token punctuation">.</span>ika<span class="token punctuation">.</span>test

<span class="token keyword">import</span> com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>build<span class="token punctuation">.</span>gradle<span class="token punctuation">.</span>AppExtension
<span class="token keyword">import</span> com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>build<span class="token punctuation">.</span>gradle<span class="token punctuation">.</span>AppPlugin
<span class="token keyword">import</span> org<span class="token punctuation">.</span>gradle<span class="token punctuation">.</span>api<span class="token punctuation">.</span>Plugin
<span class="token keyword">import</span> org<span class="token punctuation">.</span>gradle<span class="token punctuation">.</span>api<span class="token punctuation">.</span>Project

<span class="token keyword">class</span> <span class="token class-name">TestPlugin</span> <span class="token keyword">implements</span> <span class="token class-name">Plugin</span><span class="token operator">&lt;</span>Project<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">void</span> <span class="token function">apply</span><span class="token punctuation">(</span>Project project<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>project<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span><span class="token function">hasPlugin</span><span class="token punctuation">(</span>AppPlugin<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            AppExtension appExtension <span class="token operator">=</span> project<span class="token punctuation">.</span>extensions<span class="token punctuation">.</span><span class="token function">getByType</span><span class="token punctuation">(</span>AppExtension<span class="token punctuation">)</span>

            appExtension<span class="token punctuation">.</span><span class="token function">registerTransform</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TestTransform</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="使用插桩" tabindex="-1"><a class="header-anchor" href="#使用插桩" aria-hidden="true">#</a> 使用插桩</h3><p>编辑需要应用该插件的项目 <code>build.gradle</code> 文件，加入</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>apply plugin<span class="token punctuation">:</span> <span class="token string">&#39;com.ika.test&#39;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>更多细节参考<strong>插件</strong>章节。</p><h2 id="构建管理" tabindex="-1"><a class="header-anchor" href="#构建管理" aria-hidden="true">#</a> 构建管理</h2><h3 id="环境变量" tabindex="-1"><a class="header-anchor" href="#环境变量" aria-hidden="true">#</a> 环境变量</h3><p>使用 <code>ext</code> 指令设置构建时需要使用到的环境变量，这些变量通常是定义在主项目的 <code>build.gradle</code> 文件中的：</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>ext <span class="token punctuation">{</span>
    MIN_SDK_VERSION       <span class="token operator">=</span> <span class="token number">24</span>
    APP_COMPAT_DEPENDENCY <span class="token operator">=</span> <span class="token string">&#39;androidx.appcompat:appcompat:1.1.0&#39;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>在子项目的 <code>build.gradle</code> 文件中使用：</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>android <span class="token punctuation">{</span>
    defaultConfig <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
        minSdkVersion MIN_SDK_VERSION
    <span class="token punctuation">}</span>

    dependencies <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
        implementation APP_COMPAT_DEPENDENCY
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="highlight-lines"><br><br><br><div class="highlight-line"> </div><br><br><br><br><div class="highlight-line"> </div><br><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="敏感信息" tabindex="-1"><a class="header-anchor" href="#敏感信息" aria-hidden="true">#</a> 敏感信息</h3><p>如用户名、密码之类的敏感信息，不想被提交到版本控制中泄漏，通常可以配置在 <code>local.properties</code> 中：</p><div class="language-ini ext-ini line-numbers-mode"><pre class="language-ini"><code><span class="token key attr-name">USERNAME</span><span class="token punctuation">=</span><span class="token value attr-value">ika</span>
<span class="token key attr-name">PASSWORD</span><span class="token punctuation">=</span><span class="token value attr-value">123456</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>之后通过以下代码在 <code>build.gradle</code> 脚本中拿到：</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>Properties properties <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
properties<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>project<span class="token punctuation">.</span>rootProject<span class="token punctuation">.</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string">&#39;local.properties&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">newDataInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> username <span class="token operator">=</span> properties<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&#39;USERNAME&#39;</span><span class="token punctuation">)</span>  <span class="token comment">// ika</span>
<span class="token keyword">def</span> password <span class="token operator">=</span> properties<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&#39;PASSWORD&#39;</span><span class="token punctuation">)</span>  <span class="token comment">// 123456</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="查看依赖树" tabindex="-1"><a class="header-anchor" href="#查看依赖树" aria-hidden="true">#</a> 查看依赖树</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>./gradlew :app:dependencies
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>查看指定 <a href="#%E5%A4%9A%E6%B8%A0%E9%81%93%E6%9E%84%E5%BB%BA">构建变体</a> 配置的依赖树：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>./gradlew :app:dependencies --configuration xiaomiDebugCompileClasspath
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h3 id="禁止某项依赖" tabindex="-1"><a class="header-anchor" href="#禁止某项依赖" aria-hidden="true">#</a> 禁止某项依赖</h3><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>configurations<span class="token punctuation">.</span>all <span class="token punctuation">{</span>
    resolutionStrategy<span class="token punctuation">.</span>eachDependency <span class="token punctuation">{</span> details <span class="token operator">-&gt;</span>
        String dependency <span class="token operator">=</span> details<span class="token punctuation">.</span>requested<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>dependency<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&#39;com.google.android.material&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string gstring">&quot;不允许使用 <span class="token expression"><span class="token punctuation">$</span>dependency</span>&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="android-项目" tabindex="-1"><a class="header-anchor" href="#android-项目" aria-hidden="true">#</a> Android 项目</h2><h3 id="基础结构-1" tabindex="-1"><a class="header-anchor" href="#基础结构-1" aria-hidden="true">#</a> 基础结构</h3><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token operator">.</span>
├── app                                     <span class="token comment">// app 子项目（默认 Android 主项目）</span>
│   ├── build<span class="token operator">.</span>gradle                        <span class="token comment">// 子项目构建脚本</span>
│   ├── libs                                <span class="token comment">// 用于放置第三方 jar 包</span>
│   ├── proguard<span class="token operator">-</span>rules<span class="token operator">.</span>pro                  <span class="token comment">// 子项目混淆配置文件</span>
│   └── src<span class="token operator">/</span>main
│       ├── AndroidManifest<span class="token operator">.</span>xml             <span class="token comment">// Android 应用清单文件</span>
│       ├── java<span class="token operator">/</span>com<span class="token operator">/</span>example<span class="token operator">/</span>myapplication
│       │   └── MainActivity<span class="token operator">.</span>java           <span class="token comment">// 入口 Activity</span>
│       └── res<span class="token operator">/</span>layout
│           └── activity_main<span class="token operator">.</span>xml           <span class="token comment">// 入口 Activity 布局</span>
├── build<span class="token operator">.</span>gradle                            <span class="token comment">// 项目构建脚本</span>
├── gradle<span class="token operator">/</span>wrapper
│   ├── gradle<span class="token operator">-</span>wrapper<span class="token operator">.</span>jar                  <span class="token comment">// Gradle wrapper 源码</span>
│   └── gradle<span class="token operator">-</span>wrapper<span class="token operator">.</span>properties           <span class="token comment">// Gradle wrapper 参数配置</span>
├── gradle<span class="token operator">.</span>properties                       <span class="token comment">// Gradle 参数配置</span>
├── gradlew                                 <span class="token comment">// Gradle wrapper *nix 运行脚本</span>
├── gradlew<span class="token operator">.</span>bat                             <span class="token comment">// Gradle wrapper Windows 运行脚本</span>
├── local<span class="token operator">.</span>properties                        <span class="token comment">// 本地项目参数配置，如各类账号密码，一般不提交版本控制</span>
└── settings<span class="token operator">.</span>gradle                         <span class="token comment">// 项目 Gradle 配置</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="引入第三方库" tabindex="-1"><a class="header-anchor" href="#引入第三方库" aria-hidden="true">#</a> 引入第三方库</h3><ul><li><p>本地引入：直接下载 jar 包到子项目的 <code>libs</code> 目录；</p></li><li><p>远程引入：将第三方库的依赖信息添加到 Gradle 脚本，由 Gradle 自动管理依赖关系：</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code><span class="token comment">// 子项目构建脚本 build.gradle</span>

dependencies <span class="token punctuation">{</span>
    implementation <span class="token string">&#39;androidx.appcompat:appcompat:1.1.0&#39;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ul><h3 id="多项目构建" tabindex="-1"><a class="header-anchor" href="#多项目构建" aria-hidden="true">#</a> 多项目构建</h3><p>可以透过 Android Studio 菜单栏中的 <code>File -&gt; New -&gt; New Module...</code> 创建一个新的 Android Library，它将作为子项目加入到构建流程之中。新的目录结构如下：</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token operator">.</span>
├── app                                     <span class="token comment">// app 子项目（默认 Android 主项目）</span>
│   ├── <span class="token operator">...</span>
├── foundation                              <span class="token comment">// 新建的 foundation 子项目（Library）</span>
│   ├── build<span class="token operator">.</span>gradle                        <span class="token comment">// 子项目构建脚本</span>
│   ├── consumer<span class="token operator">-</span>rules<span class="token operator">.</span>pro                  <span class="token comment">// 子项目混淆配置文件（主项目用）</span>
│   ├── libs                                <span class="token comment">// 用于放置第三方 jar 包</span>
│   ├── proguard<span class="token operator">-</span>rules<span class="token operator">.</span>pro                  <span class="token comment">// 子项目混淆配置文件（自己用）</span>
│   └── src<span class="token operator">/</span>main
│       ├── AndroidManifest<span class="token operator">.</span>xml             <span class="token comment">// Android 应用清单文件</span>
│       └── java<span class="token operator">/</span>com<span class="token operator">/</span>example<span class="token operator">/</span>foundation
│           └── Core<span class="token operator">.</span>java                   <span class="token comment">// 自定义类</span>
├── build<span class="token operator">.</span>gradle                            <span class="token comment">// 项目构建脚本</span>
└── <span class="token operator">...</span>
</code></pre><div class="highlight-lines"><br><br><br><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><br><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>同时 Android Studio 会自动的在 <code>settings.gradle</code> 文件中加入对 <code>foundation</code> 子项目的引用：</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>include <span class="token string">&#39;:app&#39;</span>
include <span class="token string">&#39;:foundation&#39;</span>
rootProject<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string gstring">&quot;My Application&quot;</span>
</code></pre><div class="highlight-lines"><br><div class="highlight-line"> </div><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="释出优化" tabindex="-1"><a class="header-anchor" href="#释出优化" aria-hidden="true">#</a> 释出优化</h3><p>一般情况下，供用户下载使用的安装包文件需使用优化模式构建。一方面可以减小安装包体积、提高安装速度，另一方面还可以提高 App 的安全门槛。编辑子项目的 <code>build.gradle</code> 文件：</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>android <span class="token punctuation">{</span>
    buildTypes <span class="token punctuation">{</span>
        release <span class="token punctuation">{</span>
            <span class="token comment">// 代码混淆</span>
            minifyEnabled <span class="token boolean">true</span>
            proguardFiles <span class="token function">getDefaultProguardFile</span><span class="token punctuation">(</span><span class="token string">&#39;proguard-android-optimize.txt&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#39;proguard-rules.pro&#39;</span>
            <span class="token comment">// zipAlign 优化</span>
            zipAlignEnabled <span class="token boolean">true</span>
            <span class="token comment">// 移除无用 resource 文件</span>
            shrinkResources <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="highlight-lines"><br><br><br><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><br><br><br><br><br><br><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>有时一些方法不想被混淆，比如需要用于反射。这时候可以使用子项目下的 <code>proguard-rules.pro</code> 文件来配置忽略清单。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token operator">-</span>keepclasseswithmembers <span class="token keyword">class</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>myapplication<span class="token punctuation">.</span></span>Foo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token operator">*</span><span class="token punctuation">;</span>                    <span class="token comment">// 不对所有 public 的方法混淆</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 不对 doSomething 方法混淆</span>
<span class="token punctuation">}</span>

<span class="token comment">// 更多规则参考：http://developer.android.com/guide/developing/tools/proguard.html</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="应用签名" tabindex="-1"><a class="header-anchor" href="#应用签名" aria-hidden="true">#</a> 应用签名</h3><p>默认的 Debug 构建使用的是测试签名，而如果要将应用发布，则一般需要配置自己的签名文件。</p><p>在配置签名前，需要先有一个 KeyStore 文件。可以通过 Android Studio 菜单栏中的 <code>Build - Generate Signed Bundle / APK ...</code> 创建。之后修改子项目的 <code>build.gradle</code> 文件来应用它。</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>android <span class="token punctuation">{</span>
    signingConfigs <span class="token punctuation">{</span>
        release <span class="token punctuation">{</span>
            keyAlias <span class="token string">&#39;com.example.myapplication&#39;</span>
            keyPassword <span class="token string">&#39;password&#39;</span>
            storeFile <span class="token function">file</span><span class="token punctuation">(</span><span class="token string">&#39;myapplication.keystore&#39;</span><span class="token punctuation">)</span>
            storePassword <span class="token string">&#39;password&#39;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    buildTypes <span class="token punctuation">{</span>
        release <span class="token punctuation">{</span>
            signingConfig signingConfigs<span class="token punctuation">.</span>release
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="多渠道构建" tabindex="-1"><a class="header-anchor" href="#多渠道构建" aria-hidden="true">#</a> 多渠道构建</h3><p>通过 Gradle 构建变体可以轻松实现应用多渠道打包。在子项目的 <code>build.gradle</code> 文件中分别定义不同厂商的构建变体：</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>android <span class="token punctuation">{</span>
    flavorDimensions <span class="token string">&#39;channel&#39;</span>
    <span class="token comment">// flavorDimensions &#39;channel&#39;, &#39;version&#39;  // 多纬度</span>

    productFlavors <span class="token punctuation">{</span>
        xiaomi <span class="token punctuation">{</span>
            dimension <span class="token string">&#39;channel&#39;</span>
            manifestPlaceholders <span class="token operator">=</span> <span class="token punctuation">[</span>MTA_CHANNEL_VALUE<span class="token punctuation">:</span> <span class="token string gstring">&quot;xiaomi&quot;</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
        huawei <span class="token punctuation">{</span>
            dimension <span class="token string">&#39;channel&#39;</span>
            manifestPlaceholders <span class="token operator">=</span> <span class="token punctuation">[</span>MTA_CHANNEL_VALUE<span class="token punctuation">:</span> <span class="token string gstring">&quot;huawei&quot;</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>

        <span class="token comment">/* 多纬度：
         v1 {
            dimension &#39;version&#39;
            // ...
        }
        v2 {
            dimension &#39;version&#39;
            // ...
        } */</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>然后在 <code>AndroidManifest.xml</code> 的 <code>application</code> 节点中定义元信息占位符</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta-data</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>MTA_CHANNEL<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">android:</span>value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${MTA_CHANNEL_VALUE}<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>最后在 Activity 中通过 <code>PackageManager</code> 即可取到 <code>MTA_CHANNEL</code> 实际的值</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token class-name">ApplicationInfo</span> applicationInfo <span class="token operator">=</span> <span class="token function">getPackageManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">getApplicationInfo</span><span class="token punctuation">(</span><span class="token function">getPackageName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">PackageManager</span><span class="token punctuation">.</span>GET_META_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">String</span> mtaChannel <span class="token operator">=</span> applicationInfo<span class="token punctuation">.</span>metaData<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;MTA_CHANNEL&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// xiaomi</span>

<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">PackageManager<span class="token punctuation">.</span>NameNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>另外可以通过下面的方式修改默认的构建文件名：</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>android <span class="token punctuation">{</span>
    <span class="token comment">// 修改构建文件名</span>
    applicationVariants<span class="token punctuation">.</span>all <span class="token punctuation">{</span> variant <span class="token operator">-&gt;</span>
        variant<span class="token punctuation">.</span>outputs<span class="token punctuation">.</span>each <span class="token punctuation">{</span> output <span class="token operator">-&gt;</span>
            <span class="token keyword">def</span> outputFile <span class="token operator">=</span> output<span class="token punctuation">.</span>outputFile
            <span class="token keyword">def</span> releaseTime <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&#39;yyyyMMddHHmm&#39;</span><span class="token punctuation">,</span> TimeZone<span class="token punctuation">.</span><span class="token function">getTimeZone</span><span class="token punctuation">(</span><span class="token string">&#39;PRC&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>outputFile <span class="token operator">==</span> null <span class="token operator">||</span> <span class="token operator">!</span>outputFile<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">&#39;.apk&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// app-1.0-release-202105021635.apk</span>
            output<span class="token punctuation">.</span>outputFileName <span class="token operator">=</span> <span class="token string gstring">&quot;app-<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>defaultConfig<span class="token punctuation">.</span>versionName<span class="token punctuation">}</span></span>-<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>variant<span class="token punctuation">.</span>buildType<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span>-<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>releaseTime<span class="token punctuation">}</span></span>.apk&quot;</span>
            <span class="token comment">// app-xiaomi-1.0-release-202105021636.apk</span>
            output<span class="token punctuation">.</span>outputFileName <span class="token operator">=</span> <span class="token string gstring">&quot;app-<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>variant<span class="token punctuation">.</span>productFlavors<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">}</span></span>-<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>defaultConfig<span class="token punctuation">.</span>versionName<span class="token punctuation">}</span></span>-<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>variant<span class="token punctuation">.</span>buildType<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span>-<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>releaseTime<span class="token punctuation">}</span></span>.apk&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="多-dex-支持" tabindex="-1"><a class="header-anchor" href="#多-dex-支持" aria-hidden="true">#</a> 多 Dex 支持</h3><p>当应用及其引用的库包含的方法数超过 65536 时，需要启用多 Dex 支持，否则应用将无法被成功构建。启用的方式很简单，只需要编辑子项目的 <code>build.gradle</code> 文件：</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>android <span class="token punctuation">{</span>
    defaultConfig <span class="token punctuation">{</span>
        minSdkVersion <span class="token number">21</span>
        multiDexEnabled <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="highlight-lines"><br><br><br><div class="highlight-line"> </div><br><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>需要注意的是，当 <code>minSdkVersion</code> 低于 21 时，需要额外引入 <a href="https://mvnrepository.com/artifact/androidx.multidex/multidex" target="_blank" rel="noopener noreferrer">multidex<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> 库并加以配置。具体请参照 Android 官方文档。</p><h3 id="自定义常量" tabindex="-1"><a class="header-anchor" href="#自定义常量" aria-hidden="true">#</a> 自定义常量</h3><p>使用 <code>buildConfigField</code> 指令可以在构建时向 <code>BuildConfig</code> 类中动态加入常量，这些常量一般包含构建时的相关信息。而 <code>BuildConfig</code> 是在构建 Android 项目时，自动生成的一个类。</p><p>类文件路径：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>build<span class="token operator">/</span>generated<span class="token operator">/</span>source<span class="token operator">/</span>buildConfig<span class="token operator">/</span>debug<span class="token operator">/</span>com<span class="token operator">/</span>example<span class="token operator">/</span>myapplication<span class="token operator">/</span><span class="token class-name">BuildConfig</span><span class="token punctuation">.</span>java
<span class="token comment">// 或</span>
build<span class="token operator">/</span>generated<span class="token operator">/</span>source<span class="token operator">/</span>buildConfig<span class="token operator">/</span>xiaomi<span class="token operator">/</span>debug<span class="token operator">/</span>com<span class="token operator">/</span>example<span class="token operator">/</span>myapplication<span class="token operator">/</span><span class="token class-name">BuildConfig</span><span class="token punctuation">.</span>java
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>在构建脚本中定义：</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>android <span class="token punctuation">{</span>
    buildTypes <span class="token punctuation">{</span>
        debug <span class="token punctuation">{</span>
            <span class="token comment">// ...</span>
            <span class="token function">buildConfigField</span><span class="token punctuation">(</span><span class="token string">&#39;String&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;API_BASE&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;&quot;https://api.example.com/&quot;&#39;</span><span class="token punctuation">)</span>
            <span class="token function">buildConfigField</span><span class="token punctuation">(</span><span class="token string">&#39;String&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;BUILD_TIME&#39;</span><span class="token punctuation">,</span> <span class="token string gstring">&quot;\&quot;<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>\&quot;&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>在项目文件中使用：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 由于 BuildConfig 包名定义与项目一致，所以无需 import</span>
<span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">i</span><span class="token punctuation">(</span><span class="token string">&quot;TAG&quot;</span><span class="token punctuation">,</span> <span class="token class-name">BuildConfig</span><span class="token punctuation">.</span>API_BASE<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="自定义资源" tabindex="-1"><a class="header-anchor" href="#自定义资源" aria-hidden="true">#</a> 自定义资源</h3><p>使用 <code>resValue</code> 指令可以在构建时动态加入资源，这些资源存储在下面的文件中并和应用一起被打包：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>build<span class="token operator">/</span>generated<span class="token operator">/</span>res<span class="token operator">/</span>resValues<span class="token operator">/</span>debug<span class="token operator">/</span>values<span class="token operator">/</span>gradleResValues<span class="token punctuation">.</span>xml
<span class="token comment">// 或</span>
build<span class="token operator">/</span>generated<span class="token operator">/</span>res<span class="token operator">/</span>resValues<span class="token operator">/</span>xiaomi<span class="token operator">/</span>debug<span class="token operator">/</span>values<span class="token operator">/</span>gradleResValues<span class="token punctuation">.</span>xml
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>在构建脚本中定义：</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>android <span class="token punctuation">{</span>
    buildTypes <span class="token punctuation">{</span>
        debug <span class="token punctuation">{</span>
            <span class="token comment">// ...</span>
            <span class="token function">resValue</span><span class="token punctuation">(</span><span class="token string">&#39;string&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;greeting&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Hello World!&#39;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>在项目文件中使用：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">i</span><span class="token punctuation">(</span><span class="token string">&quot;TAG&quot;</span><span class="token punctuation">,</span> <span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>greeting<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><span class="meta-item-info">12/5/2021, 10:16:47 AM</span></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: sxyazi@gmail.com">sxyazi</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.39480b94.js" defer></script>
  </body>
</html>
