import{r as t,c as o,a as s,b as p,F as c,e,d as n,o as l}from"./app.39480b94.js";import{_ as i}from"./plugin-vue_export-helper.21dcd24c.js";const r={},u=e(`<h1 id="gradle" tabindex="-1"><a class="header-anchor" href="#gradle" aria-hidden="true">#</a> Gradle</h1><h2 id="wrapper" tabindex="-1"><a class="header-anchor" href="#wrapper" aria-hidden="true">#</a> Wrapper</h2><p>Gradle Wrapper \u662F Gradle \u7684\u5305\u88C5\u5668\u3002\u4F7F\u7528 <code>gradle wrapper</code> \u547D\u4EE4\u53EF\u5728\u5F53\u524D\u9879\u76EE\u76EE\u5F55\u751F\u6210 <code>gradlew</code> \u6587\u4EF6\u3002</p><h3 id="\u5207\u6362\u7248\u672C" tabindex="-1"><a class="header-anchor" href="#\u5207\u6362\u7248\u672C" aria-hidden="true">#</a> \u5207\u6362\u7248\u672C</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>./gradlew wrapper --gradle-version <span class="token number">6.4</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u64CD\u4F5C\u5B8C\u6210\u540E\uFF0C\u53EF\u901A\u8FC7 <code>cat gradle/wrapper/gradle-wrapper.properties</code> \u67E5\u770B\u53D8\u66F4\u540E\u7684\u7248\u672C\u4FE1\u606F\u3002</p><h3 id="\u5E38\u7528\u547D\u4EE4" tabindex="-1"><a class="header-anchor" href="#\u5E38\u7528\u547D\u4EE4" aria-hidden="true">#</a> \u5E38\u7528\u547D\u4EE4</h3><ul><li>\u6E05\u9664\u6784\u5EFA ./gradlew clean</li><li>\u67E5\u770B\u6240\u6709\u4EFB\u52A1 ./gradlew tasks</li><li>\u67E5\u770B\u6240\u6709\u5B50\u5DE5\u7A0B ./gradlew projects</li></ul><h2 id="groovy" tabindex="-1"><a class="header-anchor" href="#groovy" aria-hidden="true">#</a> Groovy</h2><p>Groovy \u662F\u4E00\u95E8\u8FD0\u884C\u5728 Java \u5E73\u53F0\u4E0A\u7684\u52A8\u6001\u8BED\u8A00\u3002Groovy \u5728\u8FD0\u884C\u65F6\u88AB\u7F16\u8BD1\u4E3A Java \u865A\u62DF\u673A\u5B57\u8282\u7801\uFF0C\u5E76\u53EF\u4EE5\u4E0E\u5176\u5B83 Java \u4EE3\u7801\u548C\u5E93\u8FDB\u884C\u4EA4\u4E92\u3002</p><h3 id="\u57FA\u672C\u7C7B\u578B" tabindex="-1"><a class="header-anchor" href="#\u57FA\u672C\u7C7B\u578B" aria-hidden="true">#</a> \u57FA\u672C\u7C7B\u578B</h3><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code><span class="token comment">// \u6570\u5B57</span>
<span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">10</span>
<span class="token keyword">double</span> b <span class="token operator">=</span> <span class="token number">3.14</span>

<span class="token comment">// \u5B57\u7B26\u4E32</span>
String str <span class="token operator">=</span> <span class="token string gstring">&quot;Hello World&quot;</span>
String str2 <span class="token operator">=</span> str <span class="token operator">+</span> str<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// \u5217\u8868</span>
<span class="token keyword">def</span> list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>

<span class="token comment">// \u6620\u5C04</span>
<span class="token keyword">def</span> map <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string gstring">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string gstring">&quot;Lucy&quot;</span><span class="token punctuation">,</span> <span class="token string gstring">&quot;age&quot;</span><span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="\u63D2\u503C" tabindex="-1"><a class="header-anchor" href="#\u63D2\u503C" aria-hidden="true">#</a> \u63D2\u503C</h3><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>String str <span class="token operator">=</span> <span class="token string gstring">&quot;Hello&quot;</span>
String str2 <span class="token operator">=</span> <span class="token string gstring">&quot;str = <span class="token expression"><span class="token punctuation">$</span>str</span>&quot;</span>

<span class="token keyword">def</span> map <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string gstring">&quot;a&quot;</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string gstring">&quot;b&quot;</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string gstring">&quot;c&quot;</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">]</span>
String str3 <span class="token operator">=</span> <span class="token string gstring">&quot;a = <span class="token expression"><span class="token punctuation">$</span>map<span class="token punctuation">.</span>a</span>, b = <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>map<span class="token punctuation">.</span>b<span class="token punctuation">}</span></span>, c = \${map[&quot;</span>c<span class="token string gstring">&quot;]}&quot;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="\u904D\u5386" tabindex="-1"><a class="header-anchor" href="#\u904D\u5386" aria-hidden="true">#</a> \u904D\u5386</h3><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>list<span class="token punctuation">.</span>each <span class="token punctuation">{</span>
    println <span class="token string gstring">&quot;item: <span class="token expression"><span class="token punctuation">$</span>it</span>&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="\u5FAA\u73AF" tabindex="-1"><a class="header-anchor" href="#\u5FAA\u73AF" aria-hidden="true">#</a> \u5FAA\u73AF</h3><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    println i
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="\u51FD\u6570" tabindex="-1"><a class="header-anchor" href="#\u51FD\u6570" aria-hidden="true">#</a> \u51FD\u6570</h3><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code><span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span>String name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    println name
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string gstring">&quot;Lily&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="\u95ED\u5305" tabindex="-1"><a class="header-anchor" href="#\u95ED\u5305" aria-hidden="true">#</a> \u95ED\u5305</h3><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code><span class="token comment">// \u65E0\u53C2</span>
<span class="token keyword">def</span> closure <span class="token operator">=</span> <span class="token punctuation">{</span> println <span class="token string gstring">&quot;Hello Closure&quot;</span> <span class="token punctuation">}</span>
<span class="token function">closure</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// \u6709\u53C2</span>
<span class="token keyword">def</span> closure2 <span class="token operator">=</span> <span class="token punctuation">{</span> it <span class="token operator">-&gt;</span> println <span class="token string gstring">&quot;Hello <span class="token expression"><span class="token punctuation">$</span>it</span>&quot;</span> <span class="token punctuation">}</span>
<span class="token function">closure2</span><span class="token punctuation">(</span><span class="token string gstring">&quot;Lucy&quot;</span><span class="token punctuation">)</span>

<span class="token comment">// \u591A\u4E2A\u53C2\u6570</span>
<span class="token keyword">def</span> closure3 <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> age <span class="token operator">-&gt;</span>
    println <span class="token string gstring">&quot;name: <span class="token expression"><span class="token punctuation">$</span>name</span>, age: <span class="token expression"><span class="token punctuation">$</span>age</span>&quot;</span>
<span class="token punctuation">}</span>
<span class="token function">closure3</span><span class="token punctuation">(</span><span class="token string gstring">&quot;Lily&quot;</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span>

<span class="token comment">// \u51FD\u6570\u6216\u65B9\u6CD5\u53EF\u4EE5\u7701\u7565\u62EC\u53F7</span>
closure
closure3 <span class="token string gstring">&quot;Lily&quot;</span> <span class="token number">18</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="\u7C7B" tabindex="-1"><a class="header-anchor" href="#\u7C7B" aria-hidden="true">#</a> \u7C7B</h3><p>\u7C7B\u7684\u8BED\u6CD5\u4E0E Java \u7C7B\u4F3C\uFF0C\u8FD9\u91CC\u4FBF\u4E0D\u518D\u5217\u4E3E\u3002</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
    <span class="token keyword">def</span> <span class="token function">say</span><span class="token punctuation">(</span>String name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        println <span class="token string gstring">&quot;I am <span class="token expression"><span class="token punctuation">$</span>name</span>&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">def</span> person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
person<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span><span class="token string gstring">&quot;Lily&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="dsl" tabindex="-1"><a class="header-anchor" href="#dsl" aria-hidden="true">#</a> DSL</h2><p>DSL\uFF08Domain specific language\uFF09\uFF0C\u9886\u57DF\u7279\u5B9A\u8BED\u8A00\u3002DSL \u540C\u6837\u4F7F\u7528 Groovy \u8BED\u8A00\u8868\u8FBE\uFF0C\u4E0B\u9762\u5C06\u5C55\u793A Groovy \u4E0E DSL \u4E4B\u95F4\u7684\u6620\u5C04\u5173\u7CFB\u3002</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code><span class="token keyword">def</span> closure <span class="token operator">=</span> <span class="token punctuation">{</span>
    compileSdkVersion <span class="token number">29</span>

    defaultConfig <span class="token punctuation">{</span>
        versionName <span class="token string gstring">&quot;1.0&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>\u5BF9\u5E94\u4E8E\u5982\u4E0B\u7684\u5B9E\u4F53\u7C7B</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code><span class="token keyword">class</span> <span class="token class-name">Android</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> compileSdkVersion
    <span class="token keyword">private</span> DefaultConfig defaultConfig

    <span class="token function">Android</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>defaultConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">def</span> <span class="token function">compileSdkVersion</span><span class="token punctuation">(</span><span class="token keyword">int</span> compileSdkVersion<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>compileSdkVersion <span class="token operator">=</span> compileSdkVersion
    <span class="token punctuation">}</span>

    <span class="token keyword">def</span> <span class="token function">defaultConfig</span><span class="token punctuation">(</span>Closure closure<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        closure<span class="token punctuation">.</span><span class="token function">setDelegate</span><span class="token punctuation">(</span>defaultConfig<span class="token punctuation">)</span>
        closure<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    String <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string gstring">&quot;Android { compileSdkVersion = <span class="token expression"><span class="token punctuation">$</span>compileSdkVersion</span>, defaultConfig = <span class="token expression"><span class="token punctuation">$</span>defaultConfig</span> }&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">DefaultConfig</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> String versionName

    <span class="token keyword">def</span> <span class="token function">versionName</span><span class="token punctuation">(</span>String versionName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>versionName <span class="token operator">=</span> versionName
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    String <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string gstring">&quot;DefaultConfig { versionName = <span class="token expression"><span class="token punctuation">$</span>versionName</span> }&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>\u6700\u540E\u5C06\u4ED6\u4EEC\u5173\u8054\u8D77\u6765\u5E76\u8FD0\u884C\uFF1A</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>closure<span class="token punctuation">.</span>delegate <span class="token operator">=</span> android
closure<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

println android
<span class="token comment">// Android { compileSdkVersion = 29, defaultConfig = DefaultConfig { versionName = 1.0 } }</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="\u914D\u7F6E\u811A\u672C" tabindex="-1"><a class="header-anchor" href="#\u914D\u7F6E\u811A\u672C" aria-hidden="true">#</a> \u914D\u7F6E\u811A\u672C</h2><ul><li>settings.gradle <ul><li>\u7528\u4E8E\u58F0\u660E\u5F53\u524D\u5DE5\u7A0B\u5305\u542B\u4E86\u54EA\u4E9B\u5B50\u5DE5\u7A0B</li></ul></li><li>build.gradle <ul><li>\u5728\u5DE5\u7A0B\u6839\u76EE\u5F55\u4E0B\u7684 <code>build.gradle</code> \u6587\u4EF6\u7528\u4E8E\u5B9A\u4E49\u6240\u6709\u5B50\u5DE5\u7A0B\u90FD\u53EF\u4EE5\u5171\u7528\u7684\u914D\u7F6E</li><li>\u6BCF\u4E00\u4E2A\u5B50\u5DE5\u7A0B\u76EE\u5F55\u4E0B\u7684 <code>build.gradle</code> \u6587\u4EF6\u7528\u4E8E\u5B9A\u4E49\u4EC5\u5C5E\u4E8E\u5F53\u524D\u5B50\u5DE5\u7A0B\u7684\u914D\u7F6E\u4E0E\u6784\u5EFA\u884C\u4E3A</li></ul></li><li>gradle.properties <ul><li>\u5B9A\u4E49 Gradle \u81EA\u8EAB\u4E0E\u9879\u76EE\u65E0\u5173\u7684\u53C2\u6570\uFF0C\u5982\u8FD0\u884C\u65F6\u6700\u5927\u7684\u53EF\u7528\u5185\u5B58\u7A7A\u95F4</li></ul></li></ul><h2 id="\u751F\u547D\u5468\u671F" tabindex="-1"><a class="header-anchor" href="#\u751F\u547D\u5468\u671F" aria-hidden="true">#</a> \u751F\u547D\u5468\u671F</h2><ul><li>\u521D\u59CB\u5316\u9636\u6BB5\uFF08rootProject\uFF09 <ul><li>\u5728\u521D\u59CB\u5316\u9636\u6BB5\uFF0C\u6536\u96C6\u9700\u8981\u53C2\u4E0E\u672C\u6B21\u6784\u5EFA\u7684\u6240\u6709\u5B50\u5DE5\u7A0B\uFF0C\u521B\u5EFA\u9879\u76EE\u7684\u5C42\u6B21\u7ED3\u6784\uFF0C\u5E76\u4E14\u4E3A\u6BCF\u4E2A\u5B50\u9879\u76EE\u521B\u5EFA\u4E00\u4E2A Project \u5B9E\u4F8B\u3002<code>settings.gradle</code> \u6587\u4EF6\u5728\u521D\u59CB\u5316\u9636\u6BB5\u524D\u88AB\u6267\u884C\u3002</li></ul></li><li>\u914D\u7F6E\u9636\u6BB5\uFF08project\uFF09 <ul><li>\u914D\u7F6E\u9636\u6BB5\u4F1A\u5206\u522B\u6267\u884C\u5404\u4E2A\u5B50\u9879\u76EE\u4E2D\u7684 <code>build.gradle</code> \u6587\u4EF6\uFF0C\u5B8C\u6210\u5BF9\u5F53\u524D\u5B50\u9879\u76EE Project \u5BF9\u8C61\u7684\u914D\u7F6E\u3002\u5E76\u4E14\u6839\u636E\u9879\u76EE\u81EA\u8EAB\u914D\u7F6E\u6784\u5EFA\u51FA\u4E00\u4E2A\u4EFB\u52A1\u4F9D\u8D56\u5173\u7CFB\u56FE\uFF0C\u4EE5\u4FBF\u5728\u4E0B\u4E2A\u9636\u6BB5\u6267\u884C\u3002</li></ul></li><li>\u6267\u884C\u9636\u6BB5\uFF08task\uFF09 <ul><li>\u628A\u300C\u914D\u7F6E\u9636\u6BB5\u300D\u6240\u751F\u6210\u7684\u4EFB\u52A1\u4F9D\u8D56\u56FE\u4F9D\u6B21\u6267\u884C\uFF0C\u6267\u884C\u5B8C\u6210\u540E\u6574\u4E2A\u751F\u547D\u5468\u671F\u7ED3\u675F\u3002</li></ul></li></ul><h2 id="task" tabindex="-1"><a class="header-anchor" href="#task" aria-hidden="true">#</a> Task</h2><p>\u4F7F\u7528 task \u6307\u4EE4\u5B9A\u4E49\u6784\u5EFA\u4EFB\u52A1\uFF0C\u4E00\u4E2A\u6216\u591A\u4E2A\u4EFB\u52A1\u7EC4\u6210\u6784\u5EFA\u6D41\u7A0B\u3002</p>`,38),k=n("\u66F4\u591A\u4FE1\u606F\u53C2\u9605\uFF1A"),d={href:"https://docs.gradle.org/current/dsl/org.gradle.api.task.html",target:"_blank",rel:"noopener noreferrer"},b=n("Task \u5BF9\u8C61"),m=n(" \u3001 "),g={href:"https://docs.gradle.org/current/userguide/build_lifecycle.html",target:"_blank",rel:"noopener noreferrer"},v=n("\u6784\u5EFA\u751F\u547D\u5468\u671F"),h=e(`<h3 id="\u5728\u4EFB\u52A1\u6267\u884C\u524D" tabindex="-1"><a class="header-anchor" href="#\u5728\u4EFB\u52A1\u6267\u884C\u524D" aria-hidden="true">#</a> \u5728\u4EFB\u52A1\u6267\u884C\u524D</h3><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>project<span class="token punctuation">.</span>clean<span class="token punctuation">.</span>doFirst <span class="token punctuation">{</span>
    println <span class="token string gstring">&quot;Should be first&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="\u5728\u4EFB\u52A1\u6267\u884C\u540E" tabindex="-1"><a class="header-anchor" href="#\u5728\u4EFB\u52A1\u6267\u884C\u540E" aria-hidden="true">#</a> \u5728\u4EFB\u52A1\u6267\u884C\u540E</h3><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>project<span class="token punctuation">.</span>clean<span class="token punctuation">.</span>doLast <span class="token punctuation">{</span>
    println <span class="token string gstring">&quot;Should be last&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="\u67E5\u627E\u7279\u5B9A\u4EFB\u52A1" tabindex="-1"><a class="header-anchor" href="#\u67E5\u627E\u7279\u5B9A\u4EFB\u52A1" aria-hidden="true">#</a> \u67E5\u627E\u7279\u5B9A\u4EFB\u52A1</h3><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>project<span class="token punctuation">.</span>tasks<span class="token punctuation">.</span>findAll <span class="token punctuation">{</span> task <span class="token operator">-&gt;</span>
    task<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string gstring">&quot;compile&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">.</span>each <span class="token punctuation">{</span> task <span class="token operator">-&gt;</span>
    task<span class="token punctuation">.</span>doFirst <span class="token punctuation">{</span>
        <span class="token comment">// TODO</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="\u672C\u6B21\u6784\u5EFA\u6240\u6709\u4EFB\u52A1" tabindex="-1"><a class="header-anchor" href="#\u672C\u6B21\u6784\u5EFA\u6240\u6709\u4EFB\u52A1" aria-hidden="true">#</a> \u672C\u6B21\u6784\u5EFA\u6240\u6709\u4EFB\u52A1</h3><p>\u5728 <code>build.gradle</code> \u6587\u4EF6\u4E2D\u52A0\u5165</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>gradle<span class="token punctuation">.</span>taskGraph<span class="token punctuation">.</span>beforeTask <span class="token punctuation">{</span> task <span class="token operator">-&gt;</span>
    println <span class="token string gstring">&quot;[all-task] <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>task<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span>&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="\u63D2\u4EF6" tabindex="-1"><a class="header-anchor" href="#\u63D2\u4EF6" aria-hidden="true">#</a> \u63D2\u4EF6</h2><p>Gradle \u7684\u63D2\u4EF6\u5206\u4E3A\uFF1A\u4E8C\u8FDB\u5236\u63D2\u4EF6\u3001\u811A\u672C\u63D2\u4EF6\u4E24\u7C7B\u3002</p><h3 id="\u4E8C\u8FDB\u5236\u63D2\u4EF6" tabindex="-1"><a class="header-anchor" href="#\u4E8C\u8FDB\u5236\u63D2\u4EF6" aria-hidden="true">#</a> \u4E8C\u8FDB\u5236\u63D2\u4EF6</h3><p>\u9996\u5148\u9700\u8981\u5728\u6839\u76EE\u5F55\u7684 <code>build.gradle</code> \u6587\u4EF6\u4E2D\u58F0\u660E\u63D2\u4EF6\u4F9D\u8D56</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>buildscript <span class="token punctuation">{</span>
    repositories <span class="token punctuation">{</span>
        <span class="token function">google</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token function">jcenter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    dependencies <span class="token punctuation">{</span>
        classpath <span class="token string gstring">&quot;com.android.tools.build:gradle:4.1.1&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><div class="highlight-line">\xA0</div><br><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>\u4E4B\u540E\u5C31\u53EF\u4EE5\u5728\u5B50\u9879\u76EE\u7684 <code>build.gradle</code> \u6587\u4EF6\u4E2D\u4F7F\u7528\u6B64\u63D2\u4EF6\u3002</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>plugins <span class="token punctuation">{</span> id <span class="token string">&#39;com.android.application&#39;</span> <span class="token punctuation">}</span>
<span class="token comment">// \u6216\u8005\uFF0C\u8F83\u65E7\u7684\u65B9\u5F0F</span>
apply plugin<span class="token punctuation">:</span> <span class="token string">&#39;com.android.application&#39;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="\u811A\u672C\u63D2\u4EF6" tabindex="-1"><a class="header-anchor" href="#\u811A\u672C\u63D2\u4EF6" aria-hidden="true">#</a> \u811A\u672C\u63D2\u4EF6</h3><p>\u811A\u672C\u63D2\u4EF6\u53EF\u4EE5\u4EC5\u662F\u4E00\u4E2A\u72EC\u7ACB\u7684 gradle \u6587\u4EF6\uFF0C\u6BD4\u5982\u6211\u5728\u6839\u76EE\u5F55\u6709\u4E00\u4E2A <code>test.gradle</code> \u6587\u4EF6\uFF1A</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>println <span class="token string gstring">&quot;Test plugin&quot;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u5982\u679C\u60F3\u8981\u4F7F\u7528\u8BE5\u63D2\u4EF6\u4FBF\u9700\u8981\u5728\u5B50\u9879\u76EE\u7684 <code>build.gradle</code> \u6587\u4EF6\u4E2D\u58F0\u660E</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>apply from<span class="token punctuation">:</span> project<span class="token punctuation">.</span>rootProject<span class="token punctuation">.</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string gstring">&quot;test.gradle&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="\u63D2\u4EF6\u5F00\u53D1" tabindex="-1"><a class="header-anchor" href="#\u63D2\u4EF6\u5F00\u53D1" aria-hidden="true">#</a> \u63D2\u4EF6\u5F00\u53D1</h2><p>\u5728\u9879\u76EE\u8DDF\u76EE\u5F55\u4E0B\u521B\u5EFA\u4E00\u4E2A\u540D\u4E3A <code>buildSrc</code> \u7684\u76EE\u5F55\uFF0C\u8BE5\u76EE\u5F55\u7684\u6587\u4EF6\u4F1A\u88AB\u81EA\u52A8\u8BC6\u522B\u4E3A Gradle \u7684\u63D2\u4EF6\u6E90\u7801\u3002</p><h3 id="\u57FA\u7840\u7ED3\u6784" tabindex="-1"><a class="header-anchor" href="#\u57FA\u7840\u7ED3\u6784" aria-hidden="true">#</a> \u57FA\u7840\u7ED3\u6784</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>.
\u251C\u2500\u2500 build.gradle
\u2514\u2500\u2500 src/main
    \u251C\u2500\u2500 groovy/com/ika/test
    \u2502   \u251C\u2500\u2500 TestExtension.groovy
    \u2502   \u2514\u2500\u2500 TestPlugin.groovy
    \u2514\u2500\u2500 resources/META-INF/gradle-plugins
        \u2514\u2500\u2500 com.ika.test.properties
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>\u63D2\u4EF6\u6784\u5EFA\u914D\u7F6E\u811A\u672C <strong><em>buildSrc/build.gradle</em></strong></p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>apply plugin<span class="token punctuation">:</span> <span class="token string">&#39;groovy&#39;</span>

repositories <span class="token punctuation">{</span>
    <span class="token function">jcenter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

dependencies <span class="token punctuation">{</span>
    implementation <span class="token function">gradleApi</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    implementation <span class="token function">localGroovy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>\u63D2\u4EF6\u5165\u53E3\u6587\u4EF6 <strong><em>buildSrc/src/main/groovy/com/ika/test/TestPlugin.groovy</em></strong></p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code><span class="token keyword">package</span> com<span class="token punctuation">.</span>ika<span class="token punctuation">.</span>test

<span class="token keyword">import</span> org<span class="token punctuation">.</span>gradle<span class="token punctuation">.</span>api<span class="token punctuation">.</span>Plugin
<span class="token keyword">import</span> org<span class="token punctuation">.</span>gradle<span class="token punctuation">.</span>api<span class="token punctuation">.</span>Project

<span class="token keyword">class</span> <span class="token class-name">TestPlugin</span> <span class="token keyword">implements</span> <span class="token class-name">Plugin</span><span class="token operator">&lt;</span>Project<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">void</span> <span class="token function">apply</span><span class="token punctuation">(</span>Project project<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        println <span class="token string gstring">&quot;test&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>\u63D2\u4EF6\u5C5E\u6027\u914D\u7F6E <strong><em>buildSrc/src/main/resources/META-INF/gradle-plugins/com.ika.test.properties</em></strong></p><div class="language-ini ext-ini line-numbers-mode"><pre class="language-ini"><code><span class="token key attr-name">implementation-class</span><span class="token punctuation">=</span><span class="token value attr-value">com.ika.test.TestPlugin</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h3 id="extension" tabindex="-1"><a class="header-anchor" href="#extension" aria-hidden="true">#</a> Extension</h3><p>\u53EF\u4EE5\u5229\u7528 Extension \u5F00\u653E\u7528\u6237\u5BF9\u63D2\u4EF6\u7684\u914D\u7F6E\u63A5\u53E3\u3002\u521B\u5EFA <strong>buildSrc/src/main/groovy/com/ika/test/TestExtension.groovy</strong> \u6587\u4EF6\uFF1A</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code><span class="token keyword">package</span> com<span class="token punctuation">.</span>ika<span class="token punctuation">.</span>test

<span class="token keyword">class</span> <span class="token class-name">TestExtension</span> <span class="token punctuation">{</span>
    String dir  <span class="token comment">// \u8FD9\u662F\u4F60\u7684\u53C2\u6570</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>\u4E4B\u540E\u5728 <code>TestPlugin.groovy</code> \u6587\u4EF6\u4E2D\u6CE8\u518C Extension\uFF1A</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code><span class="token keyword">package</span> com<span class="token punctuation">.</span>ika<span class="token punctuation">.</span>test

<span class="token keyword">import</span> org<span class="token punctuation">.</span>gradle<span class="token punctuation">.</span>api<span class="token punctuation">.</span>Plugin
<span class="token keyword">import</span> org<span class="token punctuation">.</span>gradle<span class="token punctuation">.</span>api<span class="token punctuation">.</span>Project

<span class="token keyword">class</span> <span class="token class-name">TestPlugin</span> <span class="token keyword">implements</span> <span class="token class-name">Plugin</span><span class="token operator">&lt;</span>Project<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">void</span> <span class="token function">apply</span><span class="token punctuation">(</span>Project project<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        project<span class="token punctuation">.</span><span class="token function">getExtensions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string gstring">&quot;test&quot;</span><span class="token punctuation">,</span> TestExtension<span class="token punctuation">)</span>

        <span class="token comment">// \u914D\u7F6E\u9636\u6BB5\u7ED3\u675F\uFF0C\u53EF\u4EE5\u62FF\u5230\u63D2\u4EF6\u914D\u7F6E\u4E86</span>
        project<span class="token punctuation">.</span>afterEvaluate <span class="token punctuation">{</span>
            TestExtension testExtension <span class="token operator">=</span> project<span class="token punctuation">.</span>test
            println <span class="token string gstring">&quot;Configured dir: <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>testExtension<span class="token punctuation">.</span>dir<span class="token punctuation">}</span></span>&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>\u6700\u540E\u9700\u8981\u5728\u4F60\u9879\u76EE\u7684 <code>build.gradle</code> \u6587\u4EF6\u4E2D\u5E94\u7528\u63D2\u4EF6\u548C\u63D2\u4EF6\u914D\u7F6E\uFF1A</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>apply plugin<span class="token punctuation">:</span> <span class="token string">&#39;com.ika.test&#39;</span>

test <span class="token punctuation">{</span>
    dir <span class="token function">getRootDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>absolutePath
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="\u53D1\u5E03\u63D2\u4EF6" tabindex="-1"><a class="header-anchor" href="#\u53D1\u5E03\u63D2\u4EF6" aria-hidden="true">#</a> \u53D1\u5E03\u63D2\u4EF6</h3><p>\u4E3A\u4E86\u65B9\u4FBF\u6D4B\u8BD5\uFF0C\u8FD9\u91CC\u91C7\u7528\u672C\u5730\u4ED3\u5E93\u7684\u6A21\u5F0F\u3002\u7531\u4E8E <code>buildSrc</code> \u662F\u7CFB\u7EDF\u9884\u8BBE\u76EE\u5F55\u540D\uFF0C\u6240\u4EE5\u9700\u8981\u4FEE\u6539\u4E3A\u5176\u5B83\u540D\u79F0\uFF0C\u8FD9\u91CC\u5C31\u6539\u4E3A <code>plugin-source</code></p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>plugins <span class="token punctuation">{</span>
    id <span class="token string gstring">&quot;groovy&quot;</span>
    id <span class="token string gstring">&quot;maven&quot;</span>
<span class="token punctuation">}</span>

repositories <span class="token punctuation">{</span>
    <span class="token function">jcenter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

dependencies <span class="token punctuation">{</span>
    implementation <span class="token function">gradleApi</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    implementation <span class="token function">localGroovy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

uploadArchives <span class="token punctuation">{</span>
    repositories<span class="token punctuation">.</span>mavenDeployer <span class="token punctuation">{</span>
        <span class="token function">repository</span><span class="token punctuation">(</span>url<span class="token punctuation">:</span> <span class="token function">uri</span><span class="token punctuation">(</span><span class="token string gstring">&quot;../repo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            pom<span class="token punctuation">.</span>groupId <span class="token operator">=</span> <span class="token string gstring">&quot;com.ika.test&quot;</span>
            pom<span class="token punctuation">.</span>artifactId <span class="token operator">=</span> <span class="token string gstring">&quot;gradle&quot;</span>
            pom<span class="token punctuation">.</span>version <span class="token operator">=</span> <span class="token string gstring">&quot;1.0.0&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="highlight-lines"><br><br><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>\u5728\u63D2\u4EF6\u6784\u5EFA\u811A\u672C <code>plugin-source/build.gradle</code> \u4E2D\u52A0\u5165\u672C\u5730\u4ED3\u5E93\u7684\u6784\u5EFA\u4EE3\u7801\u3002\u4E4B\u540E\u4FEE\u6539\u6839\u76EE\u5F55 <code>settings.gradle</code> \u6587\u4EF6\u52A0\u5165\u5BF9\u63D2\u4EF6\u7684\u5F15\u7528</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>include <span class="token string">&#39;:plugin-source&#39;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u6700\u540E\u4F7F\u7528 gradlew \u6784\u5EFA\u672C\u5730\u4ED3\u5E93\uFF0C\u6B64\u65F6\u6839\u76EE\u5F55\u4F1A\u51FA\u73B0\u4E00\u4E2A\u540D\u4E3A <code>repo</code> \u7684\u76EE\u5F55\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>./gradlew :plugin-source:uploadArchives
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h3 id="\u4F7F\u7528\u672C\u5730\u4ED3\u5E93" tabindex="-1"><a class="header-anchor" href="#\u4F7F\u7528\u672C\u5730\u4ED3\u5E93" aria-hidden="true">#</a> \u4F7F\u7528\u672C\u5730\u4ED3\u5E93</h3><p>\u5728\u9879\u76EE\u6839\u76EE\u5F55 <code>build.gradle</code> \u6587\u4EF6\u4E2D\u7684 <code>buildscript</code> \u6216 <code>allprojects</code> \u5757\u4E2D\u52A0\u5165\u5BF9\u672C\u5730\u4ED3\u5E93\u7684\u5F15\u7528</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>buildscript <span class="token punctuation">{</span>
    repositories <span class="token punctuation">{</span>
        <span class="token function">google</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token function">jcenter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        maven <span class="token punctuation">{</span> url <span class="token function">uri</span><span class="token punctuation">(</span><span class="token string gstring">&quot;./repo&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    dependencies <span class="token punctuation">{</span>
        classpath <span class="token string gstring">&quot;com.android.tools.build:gradle:4.1.1&quot;</span>
        classpath <span class="token string gstring">&quot;com.ika.test:gradle:1.0.0&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="highlight-lines"><br><br><br><br><div class="highlight-line">\xA0</div><br><br><br><div class="highlight-line">\xA0</div><br><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>\u6CE8\u610F <code>classpath</code> \u7684\u503C\u7684\u683C\u5F0F\u662F <code>groupId:artifactId:version</code>\u3002\u914D\u7F6E\u5B8C\u6210\u540E\u4FBF\u53EF\u4EE5\u4F7F\u7528\u8BE5\u63D2\u4EF6\u4E86\u3002</p><h2 id="apt" tabindex="-1"><a class="header-anchor" href="#apt" aria-hidden="true">#</a> APT</h2><p>APT(Annotation Processing Tool)\uFF0C\u5373\u6CE8\u89E3\u5904\u7406\u5668\uFF0C\u662F\u4E00\u79CD\u7528\u4E8E\u5904\u7406\u6CE8\u89E3\u7684\u5DE5\u5177\u3002JVM \u4F1A\u5728\u7F16\u8BD1\u671F\u8FD0\u884C APT \u53BB\u626B\u63CF\u4EE3\u7801\u4E2D\u7684\u6CE8\u89E3\u7136\u540E\u8F93\u51FA Java \u6587\u4EF6\u3002</p><h3 id="\u58F0\u660E\u6CE8\u89E3" tabindex="-1"><a class="header-anchor" href="#\u58F0\u660E\u6CE8\u89E3" aria-hidden="true">#</a> \u58F0\u660E\u6CE8\u89E3</h3><p>\u5728\u9879\u76EE\u6839\u76EE\u5F55\u521B\u5EFA <code>annotation-source</code> \u76EE\u5F55\u4F5C\u4E3A\u6CE8\u89E3\u6E90\u7801\u76EE\u5F55\uFF0C\u76EE\u5F55\u7ED3\u6784\u5982\u4E0B</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>.
\u251C\u2500\u2500 build.gradle
\u2514\u2500\u2500 src/main/java/com/ika/test
    \u2514\u2500\u2500 Page.java
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>\u6CE8\u89E3\u6784\u5EFA\u914D\u7F6E\u811A\u672C <strong><em>annotation-source/build.gradle</em></strong></p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>apply plugin<span class="token punctuation">:</span> <span class="token string">&#39;java&#39;</span>

targetCompatibility <span class="token operator">=</span> JavaVersion<span class="token punctuation">.</span>VERSION_1_9
sourceCompatibility <span class="token operator">=</span> JavaVersion<span class="token punctuation">.</span>VERSION_1_9
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Page \u6CE8\u89E3\u58F0\u660E\u6587\u4EF6 <strong><em>annotation-source/src/main/java/com/ika/test/Page.java</em></strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ika<span class="token punctuation">.</span>test</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ElementType</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Retention</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Target</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span>TYPE<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span>CLASS<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">Page</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> <span class="token function">url</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> <span class="token function">description</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="\u4F7F\u7528\u6CE8\u89E3" tabindex="-1"><a class="header-anchor" href="#\u4F7F\u7528\u6CE8\u89E3" aria-hidden="true">#</a> \u4F7F\u7528\u6CE8\u89E3</h3><p>\u5728\u9879\u76EE\u6839\u76EE\u5F55\u7684 <code>settings.gradle</code> \u6587\u4EF6\u4E2D\u5F15\u5165\u6CE8\u89E3\uFF1A</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>include <span class="token string">&#39;:annotation-source&#39;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u7136\u540E\u5728\u5B50\u9879\u76EE\u7684 <code>build.gradle</code> \u6587\u4EF6\u4E2D\u6DFB\u52A0\u5BF9\u6CE8\u89E3\u7684\u4F9D\u8D56\uFF1A</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>dependencies <span class="token punctuation">{</span>
    implementation <span class="token function">project</span><span class="token punctuation">(</span><span class="token string">&#39;:annotation-source&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>\u6700\u540E\u4FBF\u53EF\u5728\u9879\u76EE\u4EE3\u7801\u4E2D\u4F7F\u7528\u6CE8\u89E3\uFF0C\u8FD9\u91CC\u6211\u4F7F\u7528 <code>app/src/main/java/com/example/myapp/MainActivity.java</code> \u6587\u4EF6\u4F5C\u4E3A\u6F14\u793A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>myapp</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>ika<span class="token punctuation">.</span>test<span class="token punctuation">.</span></span><span class="token class-name">Page</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>os<span class="token punctuation">.</span></span><span class="token class-name">Bundle</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">androidx<span class="token punctuation">.</span>appcompat<span class="token punctuation">.</span>app<span class="token punctuation">.</span></span><span class="token class-name">AppCompatActivity</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Page</span><span class="token punctuation">(</span>url <span class="token operator">=</span> <span class="token string">&quot;page://main&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainActivity</span> <span class="token keyword">extends</span> <span class="token class-name">AppCompatActivity</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_main<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="highlight-lines"><br><br><div class="highlight-line">\xA0</div><br><br><br><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="\u58F0\u660E\u6CE8\u89E3\u5904\u7406\u5668" tabindex="-1"><a class="header-anchor" href="#\u58F0\u660E\u6CE8\u89E3\u5904\u7406\u5668" aria-hidden="true">#</a> \u58F0\u660E\u6CE8\u89E3\u5904\u7406\u5668</h3><p>\u5728\u9879\u76EE\u6839\u76EE\u5F55\u521B\u5EFA <code>processor-source</code> \u76EE\u5F55\u4F5C\u4E3A\u6CE8\u89E3\u5904\u7406\u5668\u6E90\u7801\u76EE\u5F55\uFF0C\u76EE\u5F55\u7ED3\u6784\u5982\u4E0B</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>.
\u251C\u2500\u2500 build.gradle
\u2514\u2500\u2500 src/main/java/com/ika/test
    \u2514\u2500\u2500 PageProcessor.java
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>\u6CE8\u89E3\u5904\u7406\u5668\u6784\u5EFA\u914D\u7F6E\u811A\u672C <strong><em>processor-source/build.gradle</em></strong></p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>apply plugin<span class="token punctuation">:</span> <span class="token string">&#39;java&#39;</span>

targetCompatibility <span class="token operator">=</span> JavaVersion<span class="token punctuation">.</span>VERSION_1_9
sourceCompatibility <span class="token operator">=</span> JavaVersion<span class="token punctuation">.</span>VERSION_1_9

dependencies <span class="token punctuation">{</span>
    implementation <span class="token function">project</span><span class="token punctuation">(</span><span class="token string">&#39;:annotation-source&#39;</span><span class="token punctuation">)</span>

    <span class="token comment">// auto-service \u7528\u4E8E\u81EA\u52A8\u521B\u5EFA META-INF/services/javax.annotation.processing.Processor \u6587\u4EF6\uFF0C</span>
    <span class="token comment">// \u6587\u4EF6\u5C06\u5305\u542B com.ika.test.PageProcessor\uFF0C\u8BE5\u6587\u4EF6\u5728\u88AB javac \u53D1\u73B0\u540E\u4FBF\u4F1A\u81EA\u52A8\u52A0\u8F7D PageProcessor \u7C7B\u4E86\u3002</span>
    implementation <span class="token string">&#39;com.google.auto.service:auto-service:1.0-rc7&#39;</span>
    annotationProcessor <span class="token string">&#39;com.google.auto.service:auto-service:1.0-rc7&#39;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>Page \u6CE8\u89E3\u5904\u7406\u6587\u4EF6 <strong><em>processor-source/src/main/java/com/ika/test/PageProcessor.java</em></strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ika<span class="token punctuation">.</span>test</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>auto<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">AutoService</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Writer</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Collections</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Set</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>processing<span class="token punctuation">.</span></span><span class="token class-name">AbstractProcessor</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>processing<span class="token punctuation">.</span></span><span class="token class-name">Processor</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>processing<span class="token punctuation">.</span></span><span class="token class-name">RoundEnvironment</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>model<span class="token punctuation">.</span>element<span class="token punctuation">.</span></span><span class="token class-name">Element</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>model<span class="token punctuation">.</span>element<span class="token punctuation">.</span></span><span class="token class-name">TypeElement</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@AutoService</span><span class="token punctuation">(</span><span class="token class-name">Processor</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PageProcessor</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractProcessor</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> TEMPLATE <span class="token operator">=</span> <span class="token string">&quot;package com.ika.test; public class Generated { public static String get() { return \\&quot;%s\\&quot;; } }&quot;</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">TypeElement</span><span class="token punctuation">&gt;</span></span> set<span class="token punctuation">,</span> <span class="token class-name">RoundEnvironment</span> roundEnvironment<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>roundEnvironment<span class="token punctuation">.</span><span class="token function">processingOver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// \u83B7\u53D6\u6240\u6709\u6807\u8BB0\u4E86 @Page \u6CE8\u89E3\u7684\u7C7B\u4FE1\u606F</span>
        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Element</span><span class="token punctuation">&gt;</span></span> allPageElements <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Element</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> roundEnvironment<span class="token punctuation">.</span><span class="token function">getElementsAnnotatedWith</span><span class="token punctuation">(</span><span class="token class-name">Page</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>allPageElements<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">StringBuilder</span> builder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Element</span> element <span class="token operator">:</span> allPageElements<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">final</span> <span class="token class-name">TypeElement</span> typeElement <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">TypeElement</span><span class="token punctuation">)</span> element<span class="token punctuation">;</span>

            <span class="token comment">// \u5C1D\u8BD5\u5728\u5F53\u524D\u7C7B\u83B7\u53D6 @Page \u7684\u4FE1\u606F</span>
            <span class="token keyword">final</span> <span class="token class-name">Page</span> page <span class="token operator">=</span> typeElement<span class="token punctuation">.</span><span class="token function">getAnnotation</span><span class="token punctuation">(</span><span class="token class-name">Page</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>page <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            builder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;\\\\nurl = &quot;</span> <span class="token operator">+</span> page<span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            builder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;\\\\ndescription = &quot;</span> <span class="token operator">+</span> page<span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            builder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;\\\\nreal_path = &quot;</span> <span class="token operator">+</span> typeElement<span class="token punctuation">.</span><span class="token function">getQualifiedName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Writer</span> writer <span class="token operator">=</span> processingEnv<span class="token punctuation">.</span><span class="token function">getFiler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createSourceFile</span><span class="token punctuation">(</span><span class="token string">&quot;com.ika.test.Generated&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">openWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>TEMPLATE<span class="token punctuation">,</span> builder<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            writer<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            writer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;Error while create file&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getSupportedAnnotationTypes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singleton</span><span class="token punctuation">(</span><span class="token class-name">Page</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getCanonicalName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br></div></div><h3 id="\u4F7F\u7528\u6CE8\u89E3\u5904\u7406\u5668" tabindex="-1"><a class="header-anchor" href="#\u4F7F\u7528\u6CE8\u89E3\u5904\u7406\u5668" aria-hidden="true">#</a> \u4F7F\u7528\u6CE8\u89E3\u5904\u7406\u5668</h3><p>\u5728\u9879\u76EE\u6839\u76EE\u5F55\u7684 <code>settings.gradle</code> \u6587\u4EF6\u4E2D\u5F15\u5165\u6CE8\u89E3\u5904\u7406\u5668\uFF1A</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>include <span class="token string">&#39;:processor-source&#39;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u7136\u540E\u5728\u5B50\u9879\u76EE\u7684 <code>build.gradle</code> \u6587\u4EF6\u4E2D\u6DFB\u52A0\u5BF9\u6CE8\u89E3\u5904\u7406\u5668\u7684\u4F9D\u8D56\uFF1A</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>dependencies <span class="token punctuation">{</span>
    annotationProcessor <span class="token function">project</span><span class="token punctuation">(</span><span class="token string">&#39;:processor-source&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>\u6700\u540E\u6267\u884C\u7F16\u8BD1\u547D\u4EE4\uFF0C\u4FBF\u4F1A\u81EA\u52A8\u751F\u6210 <code>app/build/generated/ap_generated_sources/debug/out/com/ika/test/Generated.java</code> \u6587\u4EF6</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>./gradlew :app:assembleDebug
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="kotlin" tabindex="-1"><a class="header-anchor" href="#kotlin" aria-hidden="true">#</a> Kotlin</h2><p>\u6DFB\u52A0\u9879\u76EE\u5BF9 Kotlin \u7684\u652F\u6301\uFF0C\u4FEE\u6539\u9879\u76EE\u6839\u76EE\u5F55\u4E0B\u7684 <code>build.gradle</code> \u6587\u4EF6\uFF0C\u5728 <code>dependencies</code> \u5757\u4E2D\u6DFB\u52A0\u4F9D\u8D56</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>dependencies <span class="token punctuation">{</span>
    classpath <span class="token string">&#39;org.jetbrains.kotlin:kotlin-gradle-plugin:1.4.30&#39;</span>
<span class="token punctuation">}</span>
</code></pre><div class="highlight-lines"><br><div class="highlight-line">\xA0</div><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>\u7136\u540E\u5728\u5B50\u9879\u76EE\u7684 build.gradle \u6587\u4EF6\u4E2D\u5E94\u7528 Kotlin \u63D2\u4EF6\uFF0C\u6211\u7684\u662F <code>app/build.gradle</code> \u6587\u4EF6\u3002</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>plugins <span class="token punctuation">{</span> id <span class="token string">&#39;kotlin-android&#39;</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h3 id="\u6CE8\u89E3\u5904\u7406\u5668\u652F\u6301" tabindex="-1"><a class="header-anchor" href="#\u6CE8\u89E3\u5904\u7406\u5668\u652F\u6301" aria-hidden="true">#</a> \u6CE8\u89E3\u5904\u7406\u5668\u652F\u6301</h3><p>\u5728\u5B50\u9879\u76EE\u7684 build.gradle \u6587\u4EF6\u4E2D\u5E94\u7528 <code>kotlin-kapt</code> \u63D2\u4EF6</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>plugins <span class="token punctuation">{</span> id <span class="token string">&#39;kotlin-kapt&#39;</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u4E4B\u540E\u66FF\u6362 <code>annotationProcessor</code> \u547D\u4EE4</p><div class="language-diff ext-diff line-numbers-mode"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">dependencies {
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">    annotationProcessor project(&#39;:processor-source&#39;)
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    kapt project(&#39;:processor-source&#39;)
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">}
</span></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="\u5411-kapt-\u4F20\u9012\u53C2\u6570" tabindex="-1"><a class="header-anchor" href="#\u5411-kapt-\u4F20\u9012\u53C2\u6570" aria-hidden="true">#</a> \u5411 Kapt \u4F20\u9012\u53C2\u6570</h3><p>\u5728\u5B50\u9879\u76EE\u7684 <code>build.gradle</code> \u6587\u4EF6\u7684 <code>android</code> \u5757\u4E2D\u6DFB\u52A0\u4F60\u7684\u53C2\u6570</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>android <span class="token punctuation">{</span>
    kapt<span class="token punctuation">.</span>arguments <span class="token punctuation">{</span>
        <span class="token function">arg</span><span class="token punctuation">(</span><span class="token string gstring">&quot;rootProjectDir&quot;</span><span class="token punctuation">,</span> rootProject<span class="token punctuation">.</span>projectDir<span class="token punctuation">.</span>absolutePath<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="\u52A8\u6001-kapt-\u53C2\u6570\u6CE8\u5165" tabindex="-1"><a class="header-anchor" href="#\u52A8\u6001-kapt-\u53C2\u6570\u6CE8\u5165" aria-hidden="true">#</a> \u52A8\u6001 Kapt \u53C2\u6570\u6CE8\u5165</h3><p>\u6211\u4EEC\u53EF\u4EE5\u5728\u81EA\u5DF1\u7684\u63D2\u4EF6\u4E2D\u5411\u5176\u5B83\u63D2\u4EF6\u6CE8\u5165\u4FE1\u606F\uFF0C\u8FD9\u91CC\u4F7F\u7528 kapt \u4F5C\u4E3A\u793A\u8303\u5411\u5176\u6CE8\u5165\u53C2\u6570\u3002\u6CE8\u610F\u9700\u8981\u5728\u5E94\u7528\u6211\u4EEC\u81EA\u5DF1\u7684\u63D2\u4EF6\u4E4B\u524D\u5148\u5E94\u7528 kapt \u63D2\u4EF6\u3002</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code><span class="token keyword">import</span> org<span class="token punctuation">.</span>gradle<span class="token punctuation">.</span>api<span class="token punctuation">.</span>Plugin
<span class="token keyword">import</span> org<span class="token punctuation">.</span>gradle<span class="token punctuation">.</span>api<span class="token punctuation">.</span>Project

<span class="token keyword">class</span> <span class="token class-name">TestPlugin</span> <span class="token keyword">implements</span> <span class="token class-name">Plugin</span><span class="token operator">&lt;</span>Project<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">void</span> <span class="token function">apply</span><span class="token punctuation">(</span>Project project<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>project<span class="token punctuation">.</span>extensions<span class="token punctuation">.</span><span class="token function">findByName</span><span class="token punctuation">(</span><span class="token string gstring">&quot;kapt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            project<span class="token punctuation">.</span>extensions<span class="token punctuation">.</span><span class="token function">findByName</span><span class="token punctuation">(</span><span class="token string gstring">&quot;kapt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>arguments <span class="token punctuation">{</span>
                <span class="token function">arg</span><span class="token punctuation">(</span><span class="token string gstring">&quot;rootProjectDir&quot;</span><span class="token punctuation">,</span> project<span class="token punctuation">.</span>rootProject<span class="token punctuation">.</span>projectDir<span class="token punctuation">.</span>absolutePath<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="\u5B57\u8282\u7801\u63D2\u6869" tabindex="-1"><a class="header-anchor" href="#\u5B57\u8282\u7801\u63D2\u6869" aria-hidden="true">#</a> \u5B57\u8282\u7801\u63D2\u6869</h2><p>Java \u6216 Kotlin \u8BED\u8A00\u7684\u6E90\u4EE3\u7801\u6587\u4EF6\u6700\u7EC8\u90FD\u4F1A\u7F16\u8BD1\u4E3A <code>.class</code> \u5B57\u8282\u7801\u6587\u4EF6\uFF0C\u8FD0\u884C\u5728 JVM \u865A\u62DF\u673A\u5F53\u4E2D\u3002</p><p>\u800C\u5229\u7528\u63D2\u6869\u6280\u672F\u5219\u53EF\u4EE5\u5B9E\u73B0\u52A8\u6001\u4EE3\u7801\u63D2\u5165\u3001\u4EE3\u7801\u66FF\u6362\u3002\u5B9E\u9645\u5E94\u7528\u6765\u8BB2\uFF0C\u65E0\u75D5\u57CB\u70B9\u3001\u6027\u80FD\u76D1\u63A7\u90FD\u4F1A\u7528\u5230\u5B57\u8282\u7801\u63D2\u6869\u6280\u672F\u3002</p><h3 id="\u76EE\u5F55\u7ED3\u6784" tabindex="-1"><a class="header-anchor" href="#\u76EE\u5F55\u7ED3\u6784" aria-hidden="true">#</a> \u76EE\u5F55\u7ED3\u6784</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>.
\u251C\u2500\u2500 build.gradle
\u2514\u2500\u2500 src/main
    \u251C\u2500\u2500 groovy/com/ika/test
    \u2502   \u251C\u2500\u2500 TestPlugin.groovy
    \u2502   \u251C\u2500\u2500 TestTransform.groovy
    \u2502   \u2514\u2500\u2500 TestTransformCollector.groovy
    \u2514\u2500\u2500 resources/META-INF/gradle-plugins
        \u2514\u2500\u2500 com.ika.test.properties
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>\u63D2\u4EF6\u6784\u5EFA\u914D\u7F6E\u811A\u672C <strong><em>buildSrc/build.gradle</em></strong></p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>repositories <span class="token punctuation">{</span>
    <span class="token function">jcenter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">google</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

dependencies <span class="token punctuation">{</span>
    implementation <span class="token string gstring">&quot;com.android.tools.build:gradle:4.1.1&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>\u63D2\u4EF6\u5C5E\u6027\u914D\u7F6E <strong><em>buildSrc/src/main/resources/META-INF/gradle-plugins/com.ika.test.properties</em></strong></p><div class="language-ini ext-ini line-numbers-mode"><pre class="language-ini"><code><span class="token key attr-name">implementation-class</span><span class="token punctuation">=</span><span class="token value attr-value">com.ika.test.TestPlugin</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h3 id="transform" tabindex="-1"><a class="header-anchor" href="#transform" aria-hidden="true">#</a> Transform</h3><p>\u7531\u4E8E <code>.class</code> \u6587\u4EF6\u6700\u7EC8\u90FD\u4F1A\u6253\u5305\u4E3A <code>.dex</code> \u6587\u4EF6\uFF0C\u6211\u4EEC\u53EF\u4EE5\u4F7F\u7528 Transform API \u5728\u751F\u6210 class \u6587\u4EF6\u4E4B\u540E dex \u6587\u4EF6\u4E4B\u524D\u505A\u4E00\u4E9B\u4E8B\u60C5\u3002</p><p>\u63D2\u4EF6 Transform \u6587\u4EF6 <strong><em>buildSrc/src/main/groovy/com/ika/test/TestTransform.groovy</em></strong></p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code><span class="token keyword">package</span> com<span class="token punctuation">.</span>ika<span class="token punctuation">.</span>test

<span class="token keyword">import</span> com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>build<span class="token punctuation">.</span>api<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>*
<span class="token keyword">import</span> com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>build<span class="token punctuation">.</span>gradle<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>pipeline<span class="token punctuation">.</span>TransformManager
<span class="token keyword">import</span> com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>FileUtils

<span class="token keyword">class</span> <span class="token class-name">TestTransform</span> <span class="token keyword">extends</span> <span class="token class-name">Transform</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    String <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    Set<span class="token operator">&lt;</span>QualifiedContent<span class="token punctuation">.</span>ContentType<span class="token operator">&gt;</span> <span class="token function">getInputTypes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> TransformManager<span class="token punctuation">.</span>CONTENT_CLASS
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    Set<span class="token operator">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> QualifiedContent<span class="token punctuation">.</span>Scope<span class="token operator">&gt;</span> <span class="token function">getScopes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> TransformManager<span class="token punctuation">.</span>SCOPE_FULL_PROJECT
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">boolean</span> <span class="token function">isIncremental</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">void</span> <span class="token function">transform</span><span class="token punctuation">(</span>TransformInvocation transformInvocation<span class="token punctuation">)</span> <span class="token keyword">throws</span> TransformException<span class="token punctuation">,</span> InterruptedException<span class="token punctuation">,</span> IOException <span class="token punctuation">{</span>
        transformInvocation<span class="token punctuation">.</span>inputs<span class="token punctuation">.</span>each <span class="token punctuation">{</span>
            <span class="token comment">// JAR</span>
            it<span class="token punctuation">.</span>jarInputs<span class="token punctuation">.</span>each <span class="token punctuation">{</span> jarInput <span class="token operator">-&gt;</span>
                <span class="token keyword">def</span> destFile <span class="token operator">=</span> transformInvocation<span class="token punctuation">.</span>outputProvider<span class="token punctuation">.</span><span class="token function">getContentLocation</span><span class="token punctuation">(</span>jarInput<span class="token punctuation">.</span>name<span class="token punctuation">,</span> jarInput<span class="token punctuation">.</span>contentTypes<span class="token punctuation">,</span> jarInput<span class="token punctuation">.</span>scopes<span class="token punctuation">,</span> Format<span class="token punctuation">.</span>JAR<span class="token punctuation">)</span>

                TestTransformCollector<span class="token punctuation">.</span><span class="token function">jar</span><span class="token punctuation">(</span>jarInput<span class="token punctuation">.</span>file<span class="token punctuation">)</span>
                FileUtils<span class="token punctuation">.</span><span class="token function">copyFile</span><span class="token punctuation">(</span>jarInput<span class="token punctuation">.</span>file<span class="token punctuation">,</span> destFile<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// \u76EE\u5F55</span>
            it<span class="token punctuation">.</span>directoryInputs<span class="token punctuation">.</span>each <span class="token punctuation">{</span> directoryInput <span class="token operator">-&gt;</span>
                <span class="token keyword">def</span> destDir <span class="token operator">=</span> transformInvocation<span class="token punctuation">.</span>outputProvider<span class="token punctuation">.</span><span class="token function">getContentLocation</span><span class="token punctuation">(</span>directoryInput<span class="token punctuation">.</span>name<span class="token punctuation">,</span> directoryInput<span class="token punctuation">.</span>contentTypes<span class="token punctuation">,</span> directoryInput<span class="token punctuation">.</span>scopes<span class="token punctuation">,</span> Format<span class="token punctuation">.</span>DIRECTORY<span class="token punctuation">)</span>

                TestTransformCollector<span class="token punctuation">.</span><span class="token function">fileOrDir</span><span class="token punctuation">(</span>directoryInput<span class="token punctuation">.</span>file<span class="token punctuation">)</span>
                FileUtils<span class="token punctuation">.</span><span class="token function">copyDirectory</span><span class="token punctuation">(</span>directoryInput<span class="token punctuation">.</span>file<span class="token punctuation">,</span> destDir<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><p>Transform \u6536\u96C6\u5668 <strong><em>buildSrc/src/main/groovy/com/ika/test/TestTransformCollector.groovy</em></strong></p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code><span class="token keyword">package</span> com<span class="token punctuation">.</span>ika<span class="token punctuation">.</span>test

<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>jar<span class="token punctuation">.</span>JarEntry
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>jar<span class="token punctuation">.</span>JarFile

<span class="token keyword">class</span> <span class="token class-name">TestTransformCollector</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">jar</span><span class="token punctuation">(</span>File file<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Enumeration enumeration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JarFile</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">while</span> <span class="token punctuation">(</span>enumeration<span class="token punctuation">.</span><span class="token function">hasMoreElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            JarEntry jarEntry <span class="token operator">=</span> <span class="token punctuation">(</span>JarEntry<span class="token punctuation">)</span> enumeration<span class="token punctuation">.</span><span class="token function">nextElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

            <span class="token function">println</span><span class="token punctuation">(</span><span class="token string gstring">&quot;[jar-class] <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>jarEntry<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">fileOrDir</span><span class="token punctuation">(</span>File file<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">isFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">println</span><span class="token punctuation">(</span><span class="token string gstring">&quot;[file-class] <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>file<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            file<span class="token punctuation">.</span><span class="token function">listFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>each <span class="token punctuation">{</span>
                <span class="token function">fileOrDir</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>\u4E0A\u9762\u4E24\u4E2A\u6587\u4EF6\u90FD\u51C6\u5907\u597D\uFF0C\u4FBF\u53EF\u4EE5\u5728\u63D2\u4EF6\u5165\u53E3\u6587\u4EF6 <code>buildSrc/src/main/groovy/com/ika/test/TestPlugin.groovy</code> \u4E2D\u6CE8\u518C Transform\u3002</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code><span class="token keyword">package</span> com<span class="token punctuation">.</span>ika<span class="token punctuation">.</span>test

<span class="token keyword">import</span> com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>build<span class="token punctuation">.</span>gradle<span class="token punctuation">.</span>AppExtension
<span class="token keyword">import</span> com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>build<span class="token punctuation">.</span>gradle<span class="token punctuation">.</span>AppPlugin
<span class="token keyword">import</span> org<span class="token punctuation">.</span>gradle<span class="token punctuation">.</span>api<span class="token punctuation">.</span>Plugin
<span class="token keyword">import</span> org<span class="token punctuation">.</span>gradle<span class="token punctuation">.</span>api<span class="token punctuation">.</span>Project

<span class="token keyword">class</span> <span class="token class-name">TestPlugin</span> <span class="token keyword">implements</span> <span class="token class-name">Plugin</span><span class="token operator">&lt;</span>Project<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">void</span> <span class="token function">apply</span><span class="token punctuation">(</span>Project project<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>project<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span><span class="token function">hasPlugin</span><span class="token punctuation">(</span>AppPlugin<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            AppExtension appExtension <span class="token operator">=</span> project<span class="token punctuation">.</span>extensions<span class="token punctuation">.</span><span class="token function">getByType</span><span class="token punctuation">(</span>AppExtension<span class="token punctuation">)</span>

            appExtension<span class="token punctuation">.</span><span class="token function">registerTransform</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TestTransform</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="\u4F7F\u7528\u63D2\u6869" tabindex="-1"><a class="header-anchor" href="#\u4F7F\u7528\u63D2\u6869" aria-hidden="true">#</a> \u4F7F\u7528\u63D2\u6869</h3><p>\u7F16\u8F91\u9700\u8981\u5E94\u7528\u8BE5\u63D2\u4EF6\u7684\u9879\u76EE <code>build.gradle</code> \u6587\u4EF6\uFF0C\u52A0\u5165</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>apply plugin<span class="token punctuation">:</span> <span class="token string">&#39;com.ika.test&#39;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u66F4\u591A\u7EC6\u8282\u53C2\u8003<strong>\u63D2\u4EF6</strong>\u7AE0\u8282\u3002</p><h2 id="\u6784\u5EFA\u7BA1\u7406" tabindex="-1"><a class="header-anchor" href="#\u6784\u5EFA\u7BA1\u7406" aria-hidden="true">#</a> \u6784\u5EFA\u7BA1\u7406</h2><h3 id="\u73AF\u5883\u53D8\u91CF" tabindex="-1"><a class="header-anchor" href="#\u73AF\u5883\u53D8\u91CF" aria-hidden="true">#</a> \u73AF\u5883\u53D8\u91CF</h3><p>\u4F7F\u7528 <code>ext</code> \u6307\u4EE4\u8BBE\u7F6E\u6784\u5EFA\u65F6\u9700\u8981\u4F7F\u7528\u5230\u7684\u73AF\u5883\u53D8\u91CF\uFF0C\u8FD9\u4E9B\u53D8\u91CF\u901A\u5E38\u662F\u5B9A\u4E49\u5728\u4E3B\u9879\u76EE\u7684 <code>build.gradle</code> \u6587\u4EF6\u4E2D\u7684\uFF1A</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>ext <span class="token punctuation">{</span>
    MIN_SDK_VERSION       <span class="token operator">=</span> <span class="token number">24</span>
    APP_COMPAT_DEPENDENCY <span class="token operator">=</span> <span class="token string">&#39;androidx.appcompat:appcompat:1.1.0&#39;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>\u5728\u5B50\u9879\u76EE\u7684 <code>build.gradle</code> \u6587\u4EF6\u4E2D\u4F7F\u7528\uFF1A</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>android <span class="token punctuation">{</span>
    defaultConfig <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
        minSdkVersion MIN_SDK_VERSION
    <span class="token punctuation">}</span>

    dependencies <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
        implementation APP_COMPAT_DEPENDENCY
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="highlight-lines"><br><br><br><div class="highlight-line">\xA0</div><br><br><br><br><div class="highlight-line">\xA0</div><br><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="\u654F\u611F\u4FE1\u606F" tabindex="-1"><a class="header-anchor" href="#\u654F\u611F\u4FE1\u606F" aria-hidden="true">#</a> \u654F\u611F\u4FE1\u606F</h3><p>\u5982\u7528\u6237\u540D\u3001\u5BC6\u7801\u4E4B\u7C7B\u7684\u654F\u611F\u4FE1\u606F\uFF0C\u4E0D\u60F3\u88AB\u63D0\u4EA4\u5230\u7248\u672C\u63A7\u5236\u4E2D\u6CC4\u6F0F\uFF0C\u901A\u5E38\u53EF\u4EE5\u914D\u7F6E\u5728 <code>local.properties</code> \u4E2D\uFF1A</p><div class="language-ini ext-ini line-numbers-mode"><pre class="language-ini"><code><span class="token key attr-name">USERNAME</span><span class="token punctuation">=</span><span class="token value attr-value">ika</span>
<span class="token key attr-name">PASSWORD</span><span class="token punctuation">=</span><span class="token value attr-value">123456</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u4E4B\u540E\u901A\u8FC7\u4EE5\u4E0B\u4EE3\u7801\u5728 <code>build.gradle</code> \u811A\u672C\u4E2D\u62FF\u5230\uFF1A</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>Properties properties <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
properties<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>project<span class="token punctuation">.</span>rootProject<span class="token punctuation">.</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string">&#39;local.properties&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">newDataInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> username <span class="token operator">=</span> properties<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&#39;USERNAME&#39;</span><span class="token punctuation">)</span>  <span class="token comment">// ika</span>
<span class="token keyword">def</span> password <span class="token operator">=</span> properties<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&#39;PASSWORD&#39;</span><span class="token punctuation">)</span>  <span class="token comment">// 123456</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="\u67E5\u770B\u4F9D\u8D56\u6811" tabindex="-1"><a class="header-anchor" href="#\u67E5\u770B\u4F9D\u8D56\u6811" aria-hidden="true">#</a> \u67E5\u770B\u4F9D\u8D56\u6811</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>./gradlew :app:dependencies
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u67E5\u770B\u6307\u5B9A <a href="#%E5%A4%9A%E6%B8%A0%E9%81%93%E6%9E%84%E5%BB%BA">\u6784\u5EFA\u53D8\u4F53</a> \u914D\u7F6E\u7684\u4F9D\u8D56\u6811\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>./gradlew :app:dependencies --configuration xiaomiDebugCompileClasspath
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h3 id="\u7981\u6B62\u67D0\u9879\u4F9D\u8D56" tabindex="-1"><a class="header-anchor" href="#\u7981\u6B62\u67D0\u9879\u4F9D\u8D56" aria-hidden="true">#</a> \u7981\u6B62\u67D0\u9879\u4F9D\u8D56</h3><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>configurations<span class="token punctuation">.</span>all <span class="token punctuation">{</span>
    resolutionStrategy<span class="token punctuation">.</span>eachDependency <span class="token punctuation">{</span> details <span class="token operator">-&gt;</span>
        String dependency <span class="token operator">=</span> details<span class="token punctuation">.</span>requested<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>dependency<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&#39;com.google.android.material&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string gstring">&quot;\u4E0D\u5141\u8BB8\u4F7F\u7528 <span class="token expression"><span class="token punctuation">$</span>dependency</span>&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="android-\u9879\u76EE" tabindex="-1"><a class="header-anchor" href="#android-\u9879\u76EE" aria-hidden="true">#</a> Android \u9879\u76EE</h2><h3 id="\u57FA\u7840\u7ED3\u6784-1" tabindex="-1"><a class="header-anchor" href="#\u57FA\u7840\u7ED3\u6784-1" aria-hidden="true">#</a> \u57FA\u7840\u7ED3\u6784</h3><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token operator">.</span>
\u251C\u2500\u2500 app                                     <span class="token comment">// app \u5B50\u9879\u76EE\uFF08\u9ED8\u8BA4 Android \u4E3B\u9879\u76EE\uFF09</span>
\u2502   \u251C\u2500\u2500 build<span class="token operator">.</span>gradle                        <span class="token comment">// \u5B50\u9879\u76EE\u6784\u5EFA\u811A\u672C</span>
\u2502   \u251C\u2500\u2500 libs                                <span class="token comment">// \u7528\u4E8E\u653E\u7F6E\u7B2C\u4E09\u65B9 jar \u5305</span>
\u2502   \u251C\u2500\u2500 proguard<span class="token operator">-</span>rules<span class="token operator">.</span>pro                  <span class="token comment">// \u5B50\u9879\u76EE\u6DF7\u6DC6\u914D\u7F6E\u6587\u4EF6</span>
\u2502   \u2514\u2500\u2500 src<span class="token operator">/</span>main
\u2502       \u251C\u2500\u2500 AndroidManifest<span class="token operator">.</span>xml             <span class="token comment">// Android \u5E94\u7528\u6E05\u5355\u6587\u4EF6</span>
\u2502       \u251C\u2500\u2500 java<span class="token operator">/</span>com<span class="token operator">/</span>example<span class="token operator">/</span>myapplication
\u2502       \u2502   \u2514\u2500\u2500 MainActivity<span class="token operator">.</span>java           <span class="token comment">// \u5165\u53E3 Activity</span>
\u2502       \u2514\u2500\u2500 res<span class="token operator">/</span>layout
\u2502           \u2514\u2500\u2500 activity_main<span class="token operator">.</span>xml           <span class="token comment">// \u5165\u53E3 Activity \u5E03\u5C40</span>
\u251C\u2500\u2500 build<span class="token operator">.</span>gradle                            <span class="token comment">// \u9879\u76EE\u6784\u5EFA\u811A\u672C</span>
\u251C\u2500\u2500 gradle<span class="token operator">/</span>wrapper
\u2502   \u251C\u2500\u2500 gradle<span class="token operator">-</span>wrapper<span class="token operator">.</span>jar                  <span class="token comment">// Gradle wrapper \u6E90\u7801</span>
\u2502   \u2514\u2500\u2500 gradle<span class="token operator">-</span>wrapper<span class="token operator">.</span>properties           <span class="token comment">// Gradle wrapper \u53C2\u6570\u914D\u7F6E</span>
\u251C\u2500\u2500 gradle<span class="token operator">.</span>properties                       <span class="token comment">// Gradle \u53C2\u6570\u914D\u7F6E</span>
\u251C\u2500\u2500 gradlew                                 <span class="token comment">// Gradle wrapper *nix \u8FD0\u884C\u811A\u672C</span>
\u251C\u2500\u2500 gradlew<span class="token operator">.</span>bat                             <span class="token comment">// Gradle wrapper Windows \u8FD0\u884C\u811A\u672C</span>
\u251C\u2500\u2500 local<span class="token operator">.</span>properties                        <span class="token comment">// \u672C\u5730\u9879\u76EE\u53C2\u6570\u914D\u7F6E\uFF0C\u5982\u5404\u7C7B\u8D26\u53F7\u5BC6\u7801\uFF0C\u4E00\u822C\u4E0D\u63D0\u4EA4\u7248\u672C\u63A7\u5236</span>
\u2514\u2500\u2500 settings<span class="token operator">.</span>gradle                         <span class="token comment">// \u9879\u76EE Gradle \u914D\u7F6E</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="\u5F15\u5165\u7B2C\u4E09\u65B9\u5E93" tabindex="-1"><a class="header-anchor" href="#\u5F15\u5165\u7B2C\u4E09\u65B9\u5E93" aria-hidden="true">#</a> \u5F15\u5165\u7B2C\u4E09\u65B9\u5E93</h3><ul><li><p>\u672C\u5730\u5F15\u5165\uFF1A\u76F4\u63A5\u4E0B\u8F7D jar \u5305\u5230\u5B50\u9879\u76EE\u7684 <code>libs</code> \u76EE\u5F55\uFF1B</p></li><li><p>\u8FDC\u7A0B\u5F15\u5165\uFF1A\u5C06\u7B2C\u4E09\u65B9\u5E93\u7684\u4F9D\u8D56\u4FE1\u606F\u6DFB\u52A0\u5230 Gradle \u811A\u672C\uFF0C\u7531 Gradle \u81EA\u52A8\u7BA1\u7406\u4F9D\u8D56\u5173\u7CFB\uFF1A</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code><span class="token comment">// \u5B50\u9879\u76EE\u6784\u5EFA\u811A\u672C build.gradle</span>

dependencies <span class="token punctuation">{</span>
    implementation <span class="token string">&#39;androidx.appcompat:appcompat:1.1.0&#39;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ul><h3 id="\u591A\u9879\u76EE\u6784\u5EFA" tabindex="-1"><a class="header-anchor" href="#\u591A\u9879\u76EE\u6784\u5EFA" aria-hidden="true">#</a> \u591A\u9879\u76EE\u6784\u5EFA</h3><p>\u53EF\u4EE5\u900F\u8FC7 Android Studio \u83DC\u5355\u680F\u4E2D\u7684 <code>File -&gt; New -&gt; New Module...</code> \u521B\u5EFA\u4E00\u4E2A\u65B0\u7684 Android Library\uFF0C\u5B83\u5C06\u4F5C\u4E3A\u5B50\u9879\u76EE\u52A0\u5165\u5230\u6784\u5EFA\u6D41\u7A0B\u4E4B\u4E2D\u3002\u65B0\u7684\u76EE\u5F55\u7ED3\u6784\u5982\u4E0B\uFF1A</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token operator">.</span>
\u251C\u2500\u2500 app                                     <span class="token comment">// app \u5B50\u9879\u76EE\uFF08\u9ED8\u8BA4 Android \u4E3B\u9879\u76EE\uFF09</span>
\u2502   \u251C\u2500\u2500 <span class="token operator">...</span>
\u251C\u2500\u2500 foundation                              <span class="token comment">// \u65B0\u5EFA\u7684 foundation \u5B50\u9879\u76EE\uFF08Library\uFF09</span>
\u2502   \u251C\u2500\u2500 build<span class="token operator">.</span>gradle                        <span class="token comment">// \u5B50\u9879\u76EE\u6784\u5EFA\u811A\u672C</span>
\u2502   \u251C\u2500\u2500 consumer<span class="token operator">-</span>rules<span class="token operator">.</span>pro                  <span class="token comment">// \u5B50\u9879\u76EE\u6DF7\u6DC6\u914D\u7F6E\u6587\u4EF6\uFF08\u4E3B\u9879\u76EE\u7528\uFF09</span>
\u2502   \u251C\u2500\u2500 libs                                <span class="token comment">// \u7528\u4E8E\u653E\u7F6E\u7B2C\u4E09\u65B9 jar \u5305</span>
\u2502   \u251C\u2500\u2500 proguard<span class="token operator">-</span>rules<span class="token operator">.</span>pro                  <span class="token comment">// \u5B50\u9879\u76EE\u6DF7\u6DC6\u914D\u7F6E\u6587\u4EF6\uFF08\u81EA\u5DF1\u7528\uFF09</span>
\u2502   \u2514\u2500\u2500 src<span class="token operator">/</span>main
\u2502       \u251C\u2500\u2500 AndroidManifest<span class="token operator">.</span>xml             <span class="token comment">// Android \u5E94\u7528\u6E05\u5355\u6587\u4EF6</span>
\u2502       \u2514\u2500\u2500 java<span class="token operator">/</span>com<span class="token operator">/</span>example<span class="token operator">/</span>foundation
\u2502           \u2514\u2500\u2500 Core<span class="token operator">.</span>java                   <span class="token comment">// \u81EA\u5B9A\u4E49\u7C7B</span>
\u251C\u2500\u2500 build<span class="token operator">.</span>gradle                            <span class="token comment">// \u9879\u76EE\u6784\u5EFA\u811A\u672C</span>
\u2514\u2500\u2500 <span class="token operator">...</span>
</code></pre><div class="highlight-lines"><br><br><br><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><br><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>\u540C\u65F6 Android Studio \u4F1A\u81EA\u52A8\u7684\u5728 <code>settings.gradle</code> \u6587\u4EF6\u4E2D\u52A0\u5165\u5BF9 <code>foundation</code> \u5B50\u9879\u76EE\u7684\u5F15\u7528\uFF1A</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>include <span class="token string">&#39;:app&#39;</span>
include <span class="token string">&#39;:foundation&#39;</span>
rootProject<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string gstring">&quot;My Application&quot;</span>
</code></pre><div class="highlight-lines"><br><div class="highlight-line">\xA0</div><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="\u91CA\u51FA\u4F18\u5316" tabindex="-1"><a class="header-anchor" href="#\u91CA\u51FA\u4F18\u5316" aria-hidden="true">#</a> \u91CA\u51FA\u4F18\u5316</h3><p>\u4E00\u822C\u60C5\u51B5\u4E0B\uFF0C\u4F9B\u7528\u6237\u4E0B\u8F7D\u4F7F\u7528\u7684\u5B89\u88C5\u5305\u6587\u4EF6\u9700\u4F7F\u7528\u4F18\u5316\u6A21\u5F0F\u6784\u5EFA\u3002\u4E00\u65B9\u9762\u53EF\u4EE5\u51CF\u5C0F\u5B89\u88C5\u5305\u4F53\u79EF\u3001\u63D0\u9AD8\u5B89\u88C5\u901F\u5EA6\uFF0C\u53E6\u4E00\u65B9\u9762\u8FD8\u53EF\u4EE5\u63D0\u9AD8 App \u7684\u5B89\u5168\u95E8\u69DB\u3002\u7F16\u8F91\u5B50\u9879\u76EE\u7684 <code>build.gradle</code> \u6587\u4EF6\uFF1A</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>android <span class="token punctuation">{</span>
    buildTypes <span class="token punctuation">{</span>
        release <span class="token punctuation">{</span>
            <span class="token comment">// \u4EE3\u7801\u6DF7\u6DC6</span>
            minifyEnabled <span class="token boolean">true</span>
            proguardFiles <span class="token function">getDefaultProguardFile</span><span class="token punctuation">(</span><span class="token string">&#39;proguard-android-optimize.txt&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#39;proguard-rules.pro&#39;</span>
            <span class="token comment">// zipAlign \u4F18\u5316</span>
            zipAlignEnabled <span class="token boolean">true</span>
            <span class="token comment">// \u79FB\u9664\u65E0\u7528 resource \u6587\u4EF6</span>
            shrinkResources <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="highlight-lines"><br><br><br><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>\u6709\u65F6\u4E00\u4E9B\u65B9\u6CD5\u4E0D\u60F3\u88AB\u6DF7\u6DC6\uFF0C\u6BD4\u5982\u9700\u8981\u7528\u4E8E\u53CD\u5C04\u3002\u8FD9\u65F6\u5019\u53EF\u4EE5\u4F7F\u7528\u5B50\u9879\u76EE\u4E0B\u7684 <code>proguard-rules.pro</code> \u6587\u4EF6\u6765\u914D\u7F6E\u5FFD\u7565\u6E05\u5355\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token operator">-</span>keepclasseswithmembers <span class="token keyword">class</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>myapplication<span class="token punctuation">.</span></span>Foo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token operator">*</span><span class="token punctuation">;</span>                    <span class="token comment">// \u4E0D\u5BF9\u6240\u6709 public \u7684\u65B9\u6CD5\u6DF7\u6DC6</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// \u4E0D\u5BF9 doSomething \u65B9\u6CD5\u6DF7\u6DC6</span>
<span class="token punctuation">}</span>

<span class="token comment">// \u66F4\u591A\u89C4\u5219\u53C2\u8003\uFF1Ahttp://developer.android.com/guide/developing/tools/proguard.html</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="\u5E94\u7528\u7B7E\u540D" tabindex="-1"><a class="header-anchor" href="#\u5E94\u7528\u7B7E\u540D" aria-hidden="true">#</a> \u5E94\u7528\u7B7E\u540D</h3><p>\u9ED8\u8BA4\u7684 Debug \u6784\u5EFA\u4F7F\u7528\u7684\u662F\u6D4B\u8BD5\u7B7E\u540D\uFF0C\u800C\u5982\u679C\u8981\u5C06\u5E94\u7528\u53D1\u5E03\uFF0C\u5219\u4E00\u822C\u9700\u8981\u914D\u7F6E\u81EA\u5DF1\u7684\u7B7E\u540D\u6587\u4EF6\u3002</p><p>\u5728\u914D\u7F6E\u7B7E\u540D\u524D\uFF0C\u9700\u8981\u5148\u6709\u4E00\u4E2A KeyStore \u6587\u4EF6\u3002\u53EF\u4EE5\u901A\u8FC7 Android Studio \u83DC\u5355\u680F\u4E2D\u7684 <code>Build - Generate Signed Bundle / APK ...</code> \u521B\u5EFA\u3002\u4E4B\u540E\u4FEE\u6539\u5B50\u9879\u76EE\u7684 <code>build.gradle</code> \u6587\u4EF6\u6765\u5E94\u7528\u5B83\u3002</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>android <span class="token punctuation">{</span>
    signingConfigs <span class="token punctuation">{</span>
        release <span class="token punctuation">{</span>
            keyAlias <span class="token string">&#39;com.example.myapplication&#39;</span>
            keyPassword <span class="token string">&#39;password&#39;</span>
            storeFile <span class="token function">file</span><span class="token punctuation">(</span><span class="token string">&#39;myapplication.keystore&#39;</span><span class="token punctuation">)</span>
            storePassword <span class="token string">&#39;password&#39;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    buildTypes <span class="token punctuation">{</span>
        release <span class="token punctuation">{</span>
            signingConfig signingConfigs<span class="token punctuation">.</span>release
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="\u591A\u6E20\u9053\u6784\u5EFA" tabindex="-1"><a class="header-anchor" href="#\u591A\u6E20\u9053\u6784\u5EFA" aria-hidden="true">#</a> \u591A\u6E20\u9053\u6784\u5EFA</h3><p>\u901A\u8FC7 Gradle \u6784\u5EFA\u53D8\u4F53\u53EF\u4EE5\u8F7B\u677E\u5B9E\u73B0\u5E94\u7528\u591A\u6E20\u9053\u6253\u5305\u3002\u5728\u5B50\u9879\u76EE\u7684 <code>build.gradle</code> \u6587\u4EF6\u4E2D\u5206\u522B\u5B9A\u4E49\u4E0D\u540C\u5382\u5546\u7684\u6784\u5EFA\u53D8\u4F53\uFF1A</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>android <span class="token punctuation">{</span>
    flavorDimensions <span class="token string">&#39;channel&#39;</span>
    <span class="token comment">// flavorDimensions &#39;channel&#39;, &#39;version&#39;  // \u591A\u7EAC\u5EA6</span>

    productFlavors <span class="token punctuation">{</span>
        xiaomi <span class="token punctuation">{</span>
            dimension <span class="token string">&#39;channel&#39;</span>
            manifestPlaceholders <span class="token operator">=</span> <span class="token punctuation">[</span>MTA_CHANNEL_VALUE<span class="token punctuation">:</span> <span class="token string gstring">&quot;xiaomi&quot;</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
        huawei <span class="token punctuation">{</span>
            dimension <span class="token string">&#39;channel&#39;</span>
            manifestPlaceholders <span class="token operator">=</span> <span class="token punctuation">[</span>MTA_CHANNEL_VALUE<span class="token punctuation">:</span> <span class="token string gstring">&quot;huawei&quot;</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>

        <span class="token comment">/* \u591A\u7EAC\u5EA6\uFF1A
         v1 {
            dimension &#39;version&#39;
            // ...
        }
        v2 {
            dimension &#39;version&#39;
            // ...
        } */</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>\u7136\u540E\u5728 <code>AndroidManifest.xml</code> \u7684 <code>application</code> \u8282\u70B9\u4E2D\u5B9A\u4E49\u5143\u4FE1\u606F\u5360\u4F4D\u7B26</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta-data</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>MTA_CHANNEL<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">android:</span>value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\${MTA_CHANNEL_VALUE}<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u6700\u540E\u5728 Activity \u4E2D\u901A\u8FC7 <code>PackageManager</code> \u5373\u53EF\u53D6\u5230 <code>MTA_CHANNEL</code> \u5B9E\u9645\u7684\u503C</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token class-name">ApplicationInfo</span> applicationInfo <span class="token operator">=</span> <span class="token function">getPackageManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">getApplicationInfo</span><span class="token punctuation">(</span><span class="token function">getPackageName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">PackageManager</span><span class="token punctuation">.</span>GET_META_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">String</span> mtaChannel <span class="token operator">=</span> applicationInfo<span class="token punctuation">.</span>metaData<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;MTA_CHANNEL&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// xiaomi</span>

<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">PackageManager<span class="token punctuation">.</span>NameNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>\u53E6\u5916\u53EF\u4EE5\u901A\u8FC7\u4E0B\u9762\u7684\u65B9\u5F0F\u4FEE\u6539\u9ED8\u8BA4\u7684\u6784\u5EFA\u6587\u4EF6\u540D\uFF1A</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>android <span class="token punctuation">{</span>
    <span class="token comment">// \u4FEE\u6539\u6784\u5EFA\u6587\u4EF6\u540D</span>
    applicationVariants<span class="token punctuation">.</span>all <span class="token punctuation">{</span> variant <span class="token operator">-&gt;</span>
        variant<span class="token punctuation">.</span>outputs<span class="token punctuation">.</span>each <span class="token punctuation">{</span> output <span class="token operator">-&gt;</span>
            <span class="token keyword">def</span> outputFile <span class="token operator">=</span> output<span class="token punctuation">.</span>outputFile
            <span class="token keyword">def</span> releaseTime <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&#39;yyyyMMddHHmm&#39;</span><span class="token punctuation">,</span> TimeZone<span class="token punctuation">.</span><span class="token function">getTimeZone</span><span class="token punctuation">(</span><span class="token string">&#39;PRC&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>outputFile <span class="token operator">==</span> null <span class="token operator">||</span> <span class="token operator">!</span>outputFile<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">&#39;.apk&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// app-1.0-release-202105021635.apk</span>
            output<span class="token punctuation">.</span>outputFileName <span class="token operator">=</span> <span class="token string gstring">&quot;app-<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>defaultConfig<span class="token punctuation">.</span>versionName<span class="token punctuation">}</span></span>-<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>variant<span class="token punctuation">.</span>buildType<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span>-<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>releaseTime<span class="token punctuation">}</span></span>.apk&quot;</span>
            <span class="token comment">// app-xiaomi-1.0-release-202105021636.apk</span>
            output<span class="token punctuation">.</span>outputFileName <span class="token operator">=</span> <span class="token string gstring">&quot;app-<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>variant<span class="token punctuation">.</span>productFlavors<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">}</span></span>-<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>defaultConfig<span class="token punctuation">.</span>versionName<span class="token punctuation">}</span></span>-<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>variant<span class="token punctuation">.</span>buildType<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span>-<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>releaseTime<span class="token punctuation">}</span></span>.apk&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="\u591A-dex-\u652F\u6301" tabindex="-1"><a class="header-anchor" href="#\u591A-dex-\u652F\u6301" aria-hidden="true">#</a> \u591A Dex \u652F\u6301</h3><p>\u5F53\u5E94\u7528\u53CA\u5176\u5F15\u7528\u7684\u5E93\u5305\u542B\u7684\u65B9\u6CD5\u6570\u8D85\u8FC7 65536 \u65F6\uFF0C\u9700\u8981\u542F\u7528\u591A Dex \u652F\u6301\uFF0C\u5426\u5219\u5E94\u7528\u5C06\u65E0\u6CD5\u88AB\u6210\u529F\u6784\u5EFA\u3002\u542F\u7528\u7684\u65B9\u5F0F\u5F88\u7B80\u5355\uFF0C\u53EA\u9700\u8981\u7F16\u8F91\u5B50\u9879\u76EE\u7684 <code>build.gradle</code> \u6587\u4EF6\uFF1A</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>android <span class="token punctuation">{</span>
    defaultConfig <span class="token punctuation">{</span>
        minSdkVersion <span class="token number">21</span>
        multiDexEnabled <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="highlight-lines"><br><br><br><div class="highlight-line">\xA0</div><br><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div>`,164),y=n("\u9700\u8981\u6CE8\u610F\u7684\u662F\uFF0C\u5F53 "),f=s("code",null,"minSdkVersion",-1),x=n(" \u4F4E\u4E8E 21 \u65F6\uFF0C\u9700\u8981\u989D\u5916\u5F15\u5165 "),w={href:"https://mvnrepository.com/artifact/androidx.multidex/multidex",target:"_blank",rel:"noopener noreferrer"},q=n("multidex"),j=n(" \u5E93\u5E76\u52A0\u4EE5\u914D\u7F6E\u3002\u5177\u4F53\u8BF7\u53C2\u7167 Android \u5B98\u65B9\u6587\u6863\u3002"),P=e(`<h3 id="\u81EA\u5B9A\u4E49\u5E38\u91CF" tabindex="-1"><a class="header-anchor" href="#\u81EA\u5B9A\u4E49\u5E38\u91CF" aria-hidden="true">#</a> \u81EA\u5B9A\u4E49\u5E38\u91CF</h3><p>\u4F7F\u7528 <code>buildConfigField</code> \u6307\u4EE4\u53EF\u4EE5\u5728\u6784\u5EFA\u65F6\u5411 <code>BuildConfig</code> \u7C7B\u4E2D\u52A8\u6001\u52A0\u5165\u5E38\u91CF\uFF0C\u8FD9\u4E9B\u5E38\u91CF\u4E00\u822C\u5305\u542B\u6784\u5EFA\u65F6\u7684\u76F8\u5173\u4FE1\u606F\u3002\u800C <code>BuildConfig</code> \u662F\u5728\u6784\u5EFA Android \u9879\u76EE\u65F6\uFF0C\u81EA\u52A8\u751F\u6210\u7684\u4E00\u4E2A\u7C7B\u3002</p><p>\u7C7B\u6587\u4EF6\u8DEF\u5F84\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>build<span class="token operator">/</span>generated<span class="token operator">/</span>source<span class="token operator">/</span>buildConfig<span class="token operator">/</span>debug<span class="token operator">/</span>com<span class="token operator">/</span>example<span class="token operator">/</span>myapplication<span class="token operator">/</span><span class="token class-name">BuildConfig</span><span class="token punctuation">.</span>java
<span class="token comment">// \u6216</span>
build<span class="token operator">/</span>generated<span class="token operator">/</span>source<span class="token operator">/</span>buildConfig<span class="token operator">/</span>xiaomi<span class="token operator">/</span>debug<span class="token operator">/</span>com<span class="token operator">/</span>example<span class="token operator">/</span>myapplication<span class="token operator">/</span><span class="token class-name">BuildConfig</span><span class="token punctuation">.</span>java
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>\u5728\u6784\u5EFA\u811A\u672C\u4E2D\u5B9A\u4E49\uFF1A</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>android <span class="token punctuation">{</span>
    buildTypes <span class="token punctuation">{</span>
        debug <span class="token punctuation">{</span>
            <span class="token comment">// ...</span>
            <span class="token function">buildConfigField</span><span class="token punctuation">(</span><span class="token string">&#39;String&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;API_BASE&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;&quot;https://api.example.com/&quot;&#39;</span><span class="token punctuation">)</span>
            <span class="token function">buildConfigField</span><span class="token punctuation">(</span><span class="token string">&#39;String&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;BUILD_TIME&#39;</span><span class="token punctuation">,</span> <span class="token string gstring">&quot;\\&quot;<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>\\&quot;&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>\u5728\u9879\u76EE\u6587\u4EF6\u4E2D\u4F7F\u7528\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// \u7531\u4E8E BuildConfig \u5305\u540D\u5B9A\u4E49\u4E0E\u9879\u76EE\u4E00\u81F4\uFF0C\u6240\u4EE5\u65E0\u9700 import</span>
<span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">i</span><span class="token punctuation">(</span><span class="token string">&quot;TAG&quot;</span><span class="token punctuation">,</span> <span class="token class-name">BuildConfig</span><span class="token punctuation">.</span>API_BASE<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="\u81EA\u5B9A\u4E49\u8D44\u6E90" tabindex="-1"><a class="header-anchor" href="#\u81EA\u5B9A\u4E49\u8D44\u6E90" aria-hidden="true">#</a> \u81EA\u5B9A\u4E49\u8D44\u6E90</h3><p>\u4F7F\u7528 <code>resValue</code> \u6307\u4EE4\u53EF\u4EE5\u5728\u6784\u5EFA\u65F6\u52A8\u6001\u52A0\u5165\u8D44\u6E90\uFF0C\u8FD9\u4E9B\u8D44\u6E90\u5B58\u50A8\u5728\u4E0B\u9762\u7684\u6587\u4EF6\u4E2D\u5E76\u548C\u5E94\u7528\u4E00\u8D77\u88AB\u6253\u5305\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>build<span class="token operator">/</span>generated<span class="token operator">/</span>res<span class="token operator">/</span>resValues<span class="token operator">/</span>debug<span class="token operator">/</span>values<span class="token operator">/</span>gradleResValues<span class="token punctuation">.</span>xml
<span class="token comment">// \u6216</span>
build<span class="token operator">/</span>generated<span class="token operator">/</span>res<span class="token operator">/</span>resValues<span class="token operator">/</span>xiaomi<span class="token operator">/</span>debug<span class="token operator">/</span>values<span class="token operator">/</span>gradleResValues<span class="token punctuation">.</span>xml
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>\u5728\u6784\u5EFA\u811A\u672C\u4E2D\u5B9A\u4E49\uFF1A</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>android <span class="token punctuation">{</span>
    buildTypes <span class="token punctuation">{</span>
        debug <span class="token punctuation">{</span>
            <span class="token comment">// ...</span>
            <span class="token function">resValue</span><span class="token punctuation">(</span><span class="token string">&#39;string&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;greeting&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Hello World!&#39;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>\u5728\u9879\u76EE\u6587\u4EF6\u4E2D\u4F7F\u7528\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">i</span><span class="token punctuation">(</span><span class="token string">&quot;TAG&quot;</span><span class="token punctuation">,</span> <span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>greeting<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div>`,15);function T(E,S){const a=t("OutboundLink");return l(),o(c,null,[u,s("p",null,[k,s("a",d,[b,p(a)]),m,s("a",g,[v,p(a)])]),h,s("p",null,[y,f,x,s("a",w,[q,p(a)]),j]),P],64)}var C=i(r,[["render",T]]);export{C as default};
