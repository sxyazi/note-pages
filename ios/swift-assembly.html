<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.27">
    <title>Swift 汇编 | NOTES</title><meta name="description" content="Just playing around">
    <link rel="modulepreload" href="/assets/app.39480b94.js"><link rel="modulepreload" href="/assets/swift-assembly.html.3812ec7c.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper.21dcd24c.js"><link rel="modulepreload" href="/assets/swift-assembly.html.58722217.js">
    <link rel="stylesheet" href="/assets/style.4634000d.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container no-sidebar no-sidebar"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><span class="site-name">NOTES</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><!----><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><!----><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page no-sidebar"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="swift-汇编" tabindex="-1"><a class="header-anchor" href="#swift-汇编" aria-hidden="true">#</a> Swift 汇编</h1><h2 id="汇编种类" tabindex="-1"><a class="header-anchor" href="#汇编种类" aria-hidden="true">#</a> 汇编种类</h2><ul><li>8086 汇编（16bit）</li><li>x86 汇编（32bit）</li><li>x64 汇编（64bit）</li><li>ARM 汇编（嵌入式、移动设备）</li></ul><p>x86、x64 汇编根据编译器不同，有 2 种书写格式：</p><ul><li>Intel：Windows 派系；</li><li>AT&amp;T：Unix 派系；</li></ul><h2 id="常见汇编指令" tabindex="-1"><a class="header-anchor" href="#常见汇编指令" aria-hidden="true">#</a> 常见汇编指令</h2><table width="1000" style="font-family:Menlo;font-size:13px;text-align:center;line-height:23px;"><thead><tr><th>项目</th><th>AT&amp;T</th><th>Intel</th><th>说明</th></tr></thead><tbody><tr><td>寄存器命名</td><td>%rax</td><td>rax</td><td></td></tr><tr><td>操作数顺序</td><td>movq %rax, %rdx</td><td>mov rdx, rax</td><td>将 rax 的值赋值给 rdx</td></tr><tr><td>立即数</td><td>movq $3, %rax<br>movq $0x10, %rax</td><td>mov rax, 3<br>mov rax, 0x10</td><td>将 3 赋值给 rax<br>将 0x10 赋值给 rax</td></tr><tr><td>内存赋值</td><td>movq $0xa, 0x1ff7(%rip)</td><td>mov qword ptr [rip+0x1ff7], 0xa</td><td>将 0xa 赋值给地址为 rip+0x1ff7 的内存空间</td></tr><tr><td>取内存地址</td><td>leaq -0x18(%rbp), %rax</td><td>lea rax, [rbp-0x18]</td><td>将 rbp-0x18 这个地址赋值给 rax</td></tr><tr><td>jmp 指令</td><td>jmp *%rdx<br>jmp 0x4001002<br>jmp *(%rax)</td><td>jmp rdx<br>jmp 0x4001002<br>jmp [rax]</td><td>call 和 jmp 写法类似</td></tr><tr><td>操作数长度</td><td>movl %eax, %edx<br>movb $0x10, %al<br>leaw 0x10(%dx), %ax</td><td>mov edx, eax<br>mov al, 0x10<br>lea ax, [dx+0x10]</td><td><b style="color:red;">b</b> = byte (8-bit)<br><b style="color:red;">s</b> = short (16-bit integer or 32-bit floating point)<br><b style="color:red;">w</b> = word (16-bit)<br><b style="color:red;">l</b> = long (32-bit integer or 64-bit floating point)<br><b style="color:red;">q</b> = quad (64 bit)<br><b style="color:red;">t</b> = ten bytes (80-bit floating point) </td></tr></tbody></table><h2 id="寄存器" tabindex="-1"><a class="header-anchor" href="#寄存器" aria-hidden="true">#</a> 寄存器</h2><p>有 16 个常用寄存器</p><ul><li>rax、rbx、rcx、rdx、rsi、rdi、rbp、rsp</li><li>r8、r9、r10、r11、r12、r13、r14、r15</li></ul><p>寄存器的具体用途</p><ul><li>rax、rdx 常作为函数参数返回值使用；</li><li>rcx、rdx、rsi、rdi、r8、r9 等寄存器常用于存放函数参数；</li><li>rbp、rsp 用于栈操作；</li><li>rip 作为指令指针： <ul><li>存储着 CPU 下一条要执行的指令的地址；</li><li>一旦 CPU 读取一条指令，rpi 会自动指向下一条指令；</li></ul></li></ul><br><p><img src="/assembly/x86_64.png" alt=""></p><h2 id="分布规律" tabindex="-1"><a class="header-anchor" href="#分布规律" aria-hidden="true">#</a> 分布规律</h2><ul><li>内存格式地址为：<code>0x10(%rax)</code>，一般是堆空间；</li><li>内存格式地址为：<code>-0x78(%rbp)</code>，一般是局部变量，在栈空间；</li><li>内存格式地址为：<code>0x4bdc(%rip)</code>，一般是全局变量，在全局区（数据段）；</li></ul><h2 id="lldb-常用指令" tabindex="-1"><a class="header-anchor" href="#lldb-常用指令" aria-hidden="true">#</a> lldb 常用指令</h2><h3 id="格式" tabindex="-1"><a class="header-anchor" href="#格式" aria-hidden="true">#</a> 格式</h3><ul><li>x 是十六进制</li><li>f 是浮点数</li><li>d 是十进制</li></ul><h3 id="字节大小" tabindex="-1"><a class="header-anchor" href="#字节大小" aria-hidden="true">#</a> 字节大小</h3><ul><li>b (byte) - 1 字节</li><li>h (half word) - 2 字节</li><li>w (word) - 4 字节</li><li>g (giant word) - 8 字节</li></ul><h3 id="寄存器-1" tabindex="-1"><a class="header-anchor" href="#寄存器-1" aria-hidden="true">#</a> 寄存器</h3><p>读取寄存器的值</p><ul><li>register read/格式</li><li>register read/x</li></ul><p>修改寄存器的值</p><ul><li>register write 寄存器名称 数值</li><li>register write rax 0</li></ul><h3 id="内存" tabindex="-1"><a class="header-anchor" href="#内存" aria-hidden="true">#</a> 内存</h3><p>读取内存中的值</p><ul><li>x/数量-格式-字节大小 内存地址</li><li>x/3xw 0x0000010</li></ul><p>修改内存中的值</p><ul><li>memory write 内存地址 数值</li><li>memory write 0x0000010 10</li></ul><h3 id="调试" tabindex="-1"><a class="header-anchor" href="#调试" aria-hidden="true">#</a> 调试</h3><p>单步运行，把子函数当作整体一步执行（源码级别）</p><ul><li>n</li><li>next</li><li>thread step-over</li></ul><p>单步运行，遇到子函数会进入子函数（源码级别）</p><ul><li>s</li><li>step</li><li>thread step-in</li></ul><p>单步运行，把子函数当作整体一步执行（汇编级别）</p><ul><li>ni</li><li>nexti</li><li>thread step-inst-over</li></ul><p>单步运行，遇到子函数会进入子函数（汇编级别）</p><ul><li>si</li><li>stepi</li><li>thread step-inst</li></ul><p>直接执行完当前函数的所有代码，返回到上一个函数（遇到断点会断住）</p><ul><li>finish</li><li>thread step-out</li></ul><h3 id="p-po-表达式" tabindex="-1"><a class="header-anchor" href="#p-po-表达式" aria-hidden="true">#</a> p/po 表达式</h3><ul><li>p/x $rax</li><li>p (int)$rax</li></ul><ul><li>po/x $rax</li><li>po (int)$rax</li></ul><h3 id="expression-表达式" tabindex="-1"><a class="header-anchor" href="#expression-表达式" aria-hidden="true">#</a> expression 表达式</h3><ul><li>可以简写：expr 表达式</li><li>expr $rax</li><li>expr $rax = 1</li></ul><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><span class="meta-item-info">12/5/2021, 10:16:47 AM</span></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: sxyazi@gmail.com">sxyazi</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.39480b94.js" defer></script>
  </body>
</html>
